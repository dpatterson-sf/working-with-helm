<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Working with Helm</title><meta name="author" content="Daniel Hinojosa"><link rel="stylesheet" href="node_modules/reveal.js/dist/reset.css"><link rel="stylesheet" href="node_modules/reveal.js/dist/reveal.css"><link rel="stylesheet" href="node_modules/reveal.js/dist/theme/black.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* source blocks */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* auto-animate feature */
/* hide the scrollbar when auto-animating source blocks */
.reveal pre[data-auto-animate-target] {
  overflow: hidden;
}

.reveal pre[data-auto-animate-target] code {
  overflow: hidden;
}

/* add a min width to avoid horizontal shift on line numbers */
code.hljs .hljs-ln-line.hljs-ln-n {
  min-width: 1.25em;
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}

.byline {
  font-size:.8em
}
ul.byline {
  list-style-type: none;
}
ul.byline li + li {
  margin-top: 0.25em;
}
</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/v4-shims.min.css"><link rel="stylesheet" href="custom.css"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Working with Helm</h1><p class="byline">
  <span class="author">Daniel Hinojosa</span>
  </p></section><section><section id="_course_overview"><h2>Course Overview</h2><div class="slide-content"><div class="ulist"><ul><li><p>The Helm Fundamentals course is designed to be an introduction to understanding and working with the Helm Kubernetes package manager.</p></li><li><p>It will start with a journey to understand why Helm exists and its purpose.</p></li><li><p>The course will then navigate a path towards how to work with it, including</p><div class="ulist"><ul><li><p>Building charts</p></li><li><p>Publishing charts</p></li><li><p>Using them to release and manage Kubernetes workloads</p></li><li><p>Various capabilities Helm offers via its CLI</p></li></ul></div></li></ul></div></div></section><section id="_audience"><h2>Audience</h2><div class="slide-content"><div class="paragraph"><p>Developers, Service Owners, Ops</p></div></div></section><section id="_purpose_for_the_class"><h2>Purpose for the Class</h2><div class="slide-content"><div class="paragraph"><p>To gain a comprehensive understanding of Helm and how to use it to package and manage Kubernetes workloads</p></div></div></section><section id="_prerequisites_for_the_class"><h2>Prerequisites for the Class</h2><div class="slide-content"><div class="ulist"><ul><li><p>Knowledge and working experience with Kubernetes. This includes understanding common resources and usage of things like Deployments, Config Maps, Secrets, Pods, Container Spec, etc.</p></li><li><p>Some level of comfort with the command line (<code>kubectl</code>, piping output, navigating folders, etc)</p></li></ul></div></div></section><section id="_objectives"><h2>Objectives</h2><div class="slide-content"><div class="ulist"><ul><li><p>Understand the purpose of Helm, why it exists</p></li><li><p>Create Helm charts of your own ready for distribution</p></li><li><p>Test helm in local, and how to validate your changes</p></li><li><p>Understand all features and practices around Helm chart source code</p></li><li><p>Feel comfortable with best practices around using Helm as well as gotchas of Helm</p></li></ul></div></div></section><section id="_objectives_continued"><h2>Objectives (Continued)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Know how Helm charts are commonly distributed and stored, and work with Helm chart repositories</p></li><li><p>Understand the architecture of Helm, where it is today, and where it’s headed</p></li><li><p>Use the various features of the CLI including packaging charts, installing and using plugins, installing and upgrading charts.</p></li><li><p>Have awareness of development and testing strategies around Helm charts, and be able to use these strategies</p></li><li><p>How to use Helm securely</p></li></ul></div></div></section></section>
<section><section id="_introduction"><h2>Introduction</h2></section><section id="_purpose_of_helm"><h2>Purpose of Helm</h2><div class="slide-content"><div class="ulist"><ul><li><p>Manages Kubernetes Applications</p></li><li><p>Templatizes Kubernetes Resources</p></li><li><p>Repeatable Application Installation</p></li><li><p>Upgrade Applications</p></li><li><p>Reusability</p></li><li><p>Share Charts on Repositories</p></li><li><p>Rollback to Previous Applications</p></li></ul></div></div></section></section>
<section><section id="_architecture"><h2>Architecture</h2><div class="slide-content"><div class="ulist"><ul><li><p>Discuss the components of Helm</p></li><li><p>Discuss how Helm is implemented</p></li></ul></div></div></section><section id="_components_v2"><h2>Components (v2)</h2><div class="slide-content"><div class="paragraph"><p>Helm has two components (v2):</p></div>
<div class="ulist"><ul><li><p>Client</p></li><li><p>Tiller</p></li></ul></div>
<div class="imageblock"><img src="./images/helm2-arch.png" alt="helm2 arch" width="50%" height="50%"></div></div></section><section id="_components_v3"><h2>Components (v3)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Tiller has been removed</p></li><li><p>Replaced with client/library architecture</p></li><li><p>Interacts directly with the Kubernetes API Server</p></li><li><p>Security is now on a per-user basis.</p></li></ul></div>
<div class="imageblock"><img src="./images/helm3-arch.png" alt="helm3 arch" width="50%" height="50%"></div></div></section><section id="_helm_client"><h2>Helm Client</h2><div class="slide-content"><div class="ulist"><ul><li><p>Command Line for End Users</p></li><li><p>Local Chart Development</p></li><li><p>Managing Repositories</p></li><li><p>Sending charts to be installed</p></li><li><p>Asking for information about releases</p></li><li><p>Requesting upgrading or uninstalling of existing releases</p></li></ul></div></div></section><section id="_implementation"><h2>Implementation</h2><div class="slide-content"><div class="ulist"><ul><li><p>Helm is written in the Go Language</p></li><li><p>In v2, gRPC is used to interact with the server</p></li><li><p>In v3, Uses the Kubernetes client library to communicate with Kubernetes API Server</p></li></ul></div></div></section></section>
<section><section id="_installing"><h2>Installing</h2><div class="slide-content"><div class="paragraph"><p>In this section:</p></div><div class="ulist"><ul><li><p>Installing Kubectl</p></li><li><p>Installing Docker Desktop</p></li><li><p>Installing Helm</p></li></ul></div></div></section><section id="_installing_kubectl_on_mac"><h2>Installing <code>kubectl</code> on Mac</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% brew install kubectl</code></pre></div></div></div></section><section id="_installing_kubectl_on_linux"><h2>Installing <code>kubectl</code> on Linux</h2><div class="slide-content"><div class="ulist"><ul><li><p>Run the following curl download:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% curl -LO https://storage.googleapis.com/kubernetes-release/release/ \
         $(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt) \
         /bin/linux/amd64/kubectl</code></pre></div></div></li><li><p>Make <code>kubectl</code> binary executable</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% chmod +x ./kubectl</code></pre></div></div></li><li><p>Move the binary to the <code>PATH</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% sudo mv ./kubectl /usr/local/bin/kubectl</code></pre></div></div></li></ul></div></div></section><section id="_installing_docker"><h2>Installing Docker</h2><div class="slide-content"><div class="ulist"><ul><li><p>Download and install the latest docker client: <a href="https://docs.docker.com/get-docker/" class="bare">https://docs.docker.com/get-docker/</a></p></li></ul></div></div></section><section id="_install_kubernetes"><h2>Install Kubernetes</h2><div class="slide-content"><div class="openblock ribbon"><div class="content"><div class="paragraph"><p>We are going to be deploying applications on Kubernetes, therefore we need a cluster
Typically, we will manage remote clusters, but for class, and experimentation we will use Docker-Desktop
Though we are using docker-desktop, there are other solutions:</p></div></div></div>
<div class="exampleblock columns"><div class="content"><div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Remote Kubernetes</p><div class="ulist"><ul><li><p>AWS</p></li><li><p>GCP</p></li><li><p>More&#8230;&#8203;</p></li></ul></div></li></ul></div></div></div>
<div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Local Kubernetes</p><div class="ulist"><ul><li><p>Minikube</p></li><li><p>Kind</p></li><li><p>Docker Desktop</p></li><li><p>K3S</p></li></ul></div></li></ul></div></div></div></div></div></div></section><section id="_installing_docker_desktop_for_kubernetes"><h2>Installing Docker Desktop for Kubernetes</h2><div class="slide-content"><div class="paragraph"><p>Visit the Docker Menu and select <strong>Preferences</strong></p></div>
<div class="imageblock" style="float: left"><img src="./images/docker-desktop-1.png" alt="docker desktop 1" width="80%" height="80%"></div></div></section><section id="_selecting_adequate_memory"><h2>Selecting Adequate Memory</h2><div class="slide-content"><div class="paragraph"><p>Select <em>Resources</em> and ensure that you have memory of at least 8.0GB</p></div>
<div class="imageblock" style="float: left"><img src="./images/docker-desktop-3.png" alt="docker desktop 3" width="80%" height="80%"></div></div></section><section id="_turning_on_docker_desktop_kubernetes"><h2>Turning on Docker Desktop Kubernetes</h2><div class="slide-content"><div class="paragraph"><p>Select <em>Kubernetes</em> and select <em>Enable Kubernetes</em></p></div>
<div class="imageblock" style="float: left"><img src="./images/docker-desktop-2.png" alt="docker desktop 2" width="80%" height="80%"></div></div></section><section id="_installing_helm"><h2>Installing Helm</h2><div class="slide-content"><div class="ulist"><ul><li><p>Binary Source</p></li><li><p>Homebrew (MacOSX)</p></li><li><p>Chocolatey (Windows)</p></li><li><p>Snap (Linux)</p></li></ul></div></div></section><section id="_homebrew_install_of_helm_on_macosx"><h2>Homebrew Install of Helm on MacOSX</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% brew install helm</code></pre></div></div></div></section><section id="_linux_helm_install"><h2>Linux Helm Install</h2><div class="slide-content"><div class="ulist"><ul><li><p>Download from <a href="https://github.com/helm/helm/releases" class="bare">https://github.com/helm/helm/releases</a></p></li><li><p>Unpack it (<code>tar -zxvf helm-v3.3.4-linux-amd64.tgz</code>)</p></li><li><p>Find the helm binary in the unpacked directory, and move it to its desired destination (<code>mv linux-amd64/helm /usr/local/bin/helm</code>)</p></li></ul></div></div></section><section id="_other_installation_instructions"><h2>Other Installation Instructions</h2><div class="slide-content"><div class="paragraph"><p><a href="https://v3.helm.sh/docs/install/" class="bare">https://v3.helm.sh/docs/install/</a></p></div></div></section><section id="_need_to_support_both_multiple_versions_of_helm"><h2>Need to support both multiple versions of Helm?</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://github.com/tokiwong/helm-switcher" target="_blank">Helm-Switcher</a> is a CLI tool to switch between different versions of Helm 1, 2 or 3</p></li><li><p>Run the command and use the dropdown to choos the desired version of Helm.</p></li><li><p>Available only for Linux and MacOS</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ brew install tokiwong/tap/helm-switcher</code></pre></div></div>
<div class="imageblock"><img src="./images/helmswitch.gif" alt="helmswitch"></div><div class="title">Figure 1. Using Helm-Switch</div></li></ul></div></div></section><section id="_stopping_docker_desktop"><h2>Stopping Docker-Desktop</h2><div class="slide-content"><div class="ulist"><ul><li><p>At the end of the class, be sure to stop docker-desktop&#8217;s Kubernetes</p></li><li><p>Deselect <span class="menuseq"><span class="menu">Kubernetes</span>&#160;&#9656;&#32;<span class="menuitem">Enable Kubernetes</span></span> to disable</p></li></ul></div>
<div class="imageblock" style="float: left"><img src="./images/docker-desktop-2.png" alt="docker desktop 2" width="80%" height="80%"></div></div></section></section>
<section><section id="_kubernetes"><h2>Kubernetes</h2></section><section id="_review_of_resources"><h2>Review of Resources</h2></section><section id="_pod"><h2>Pod</h2><div class="slide-content"><div class="ulist"><ul><li><p>Group of one or more containers (such as Docker containers)</p></li><li><p>Shared storage/network</p></li><li><p>Specification for how to run the containers</p></li></ul></div></div></section><section id="_service"><h2>Service</h2><div class="slide-content"><div class="ulist"><ul><li><p>Service is an abstraction which defines a logical set of Pods and a policy by which to access them</p></li><li><p>Sometimes this pattern is called a microservice</p></li><li><p>The set of Pods targeted by a Service is usually determined by a selector</p></li></ul></div></div></section><section id="_deployment"><h2>Deployment</h2><div class="slide-content"><div class="ulist"><ul><li><p>Provides declarative updates for Pods and ReplicaSets.</p></li><li><p>Describe a desired state in a Deployment</p></li><li><p>Deployment Controller changes the actual state to the desired state at a controlled rate.</p></li><li><p>You can define Deployments to create new ReplicaSets,</p></li><li><p>Or remove existing Deployments and adopt all their resources with new Deployment</p></li></ul></div></div></section><section id="_configmap"><h2>ConfigMap</h2><div class="slide-content"><div class="ulist"><ul><li><p>Bind to your Pods' containers and system components at runtime</p><div class="ulist"><ul><li><p>Configuration files</p></li><li><p>Command-line arguments</p></li><li><p>Environment variables</p></li><li><p>Port numbers</p></li><li><p>Other configuration artifacts</p></li></ul></div></li><li><p>Enable you to separate your configurations from your Pods and components, making workloads portable.</p></li></ul></div></div></section><section id="_serviceaccount"><h2>ServiceAccount</h2><div class="slide-content"><div class="ulist"><ul><li><p>Service accounts allow pods to communicate to the Kubernetes API.</p></li><li><p>They are bound to specific namespaces, and created automatically by the API server or manually through API calls.</p></li><li><p>Service accounts are tied to a set of credentials</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Be familiar with <a href="https://medium.com/better-programming/k8s-tips-using-a-serviceaccount-801c433d0023" class="bare">https://medium.com/better-programming/k8s-tips-using-a-serviceaccount-801c433d0023</a></p></div></aside></div></section><section id="_ingress"><h2>Ingress</h2><div class="slide-content"><div class="ulist"><ul><li><p>Object defines rules for routing HTTP(S) traffic to applications running in a cluster.</p></li><li><p>An Ingress object is associated with one or more Service objects</p></li><li><p>Each Service is associated with a set of Pods</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>This will provide us with the ability to map an HTTP route with a Service within the same cluster
* <a href="http://salesforce.com/registration" class="bare">http://salesforce.com/registration</a> &#8594; Register Service
* <a href="http://salesforce.com/about" class="bare">http://salesforce.com/about</a> &#8594; About Service</p></div></aside></div></section><section id="_kubernetes_ingress_and_service"><h2>Kubernetes Ingress and Service</h2><div class="slide-content"><div class="imageblock"><img src="./images/ingress-flow.png" alt="ingress flow"></div>
<aside class="notes"><div class="paragraph"><p>Overview of how we will be dealing with Kubernetes
. Our traffic will be request from a Node Port or Ingress (we will be using Ingress). (Analogy: Host of the restaurant)
. This will then contact a Kubernetes Service. (Analogy: The table)
. Load Balanced Pods, each pod can service a request. (Analogy: People at a table)</p></div></aside></div></section><section id="_3_tier_architecture"><h2>3-tier Architecture</h2><div class="slide-content"><div class="imageblock"><img src="./images/3-tier.png" alt="3 tier"></div>
<aside class="notes"><div class="paragraph"><p>Salesforce uses K8s as a three tier architecture where various clusters represent
* frontend
* backend
* database</p></div></aside></div></section></section>
<section><section id="_basic_operations"><h2>Basic Operations</h2></section><section id="_glossary_of_terms"><h2>Glossary of Terms</h2></section><section id="_chart_definition"><h2><em>Chart</em> Definition</h2><div class="slide-content"><div class="ulist"><ul><li><p>A Helm package.</p></li><li><p>Contains all of the resource definitions necessary to run an application, tool, or service inside of a Kubernetes cluster.</p></li><li><p>Think of it like the Kubernetes equivalent of a Homebrew formula, an Apt dpkg, or a Yum RPM file.</p></li></ul></div></div></section><section id="_repository_definition"><h2><em>Repository</em> Definition</h2><div class="slide-content"><div class="ulist"><ul><li><p>A Repository is the place where charts can be collected and shared.</p></li><li><p>It’s like Perl’s CPAN archive, Fedora Package Database, or Maven Central but for Kubernetes packages.</p></li></ul></div></div></section><section id="_release_definition"><h2><em>Release</em> Definition</h2><div class="slide-content"><div class="ulist"><ul><li><p>A Release is an <em>instance</em> of a chart running in a Kubernetes cluster.</p></li><li><p>One chart can often be installed many times into the same cluster.</p></li><li><p>Each time it is installed, a new release is created.</p></li><li><p>For Example:</p><div class="ulist"><ul><li><p>If you want two databases running in your cluster, you can install that chart twice.</p></li><li><p>Each one will have its own release, which will in turn have its own release name.</p></li></ul></div></li></ul></div></div></section><section id="_glossary_review"><h2>Glossary Review</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Helm installs charts into Kubernetes, creating a new release for each installation. And to find new charts, you can search Helm chart repositories.</p></div></blockquote></div></div></section></section>
<section><section id="_setting_up_a_repository"><h2>Setting up a Repository</h2></section><section id="_setting_up_the_initial_repository"><h2>Setting up the Initial Repository</h2><div class="slide-content"><div class="ulist"><ul><li><p>The following is the official repository</p></li><li><p>Your use of Helm will lead you to other repositories (e.g. bitnami)</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm repo add stable https://charts.helm.sh/stable</code></pre></div></div></div></section><section id="_repository_update"><h2>Repository Update</h2><div class="slide-content"><div class="paragraph"><p>Running the following will refresh your local catalog of available helm charts</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm repo update</code></pre></div></div></div></section><section id="_finding_charts"><h2>Finding Charts</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can search for charts using:</p><div class="ulist"><ul><li><p><code>helm search hub &lt;name&gt;</code> - Search for charts in the Helm Hub or an instance of Monocular</p></li><li><p><code>helm search repo &lt;name&gt;</code> - Search repositories for a keyword in all your repositories</p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm search hub mysql</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Monocular is a web-based application that enables the search and discovery of charts from multiple Helm Chart repositories.</td></tr></table></div></div></section><section id="_chart_search_results"><h2>Chart Search Results</h2><div class="slide-content"><div class="paragraph"><p>Returns for example:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">URL                                               	CHART VERSION	APP VERSION 	DESCRIPTION
https://hub.helm.sh/charts/prometheus-com/prome...	0.7.1        	v0.11.0     	A Helm chart for prometheus mysql exporter with...
https://hub.helm.sh/charts/incubator/mysqlha      	2.0.0        	5.7.13      	MySQL cluster with a single master and zero or ...
https://hub.helm.sh/charts/presslabs/mysql-cluster	0.2.0        	1.0         	A Helm chart for easy deployment of a MySQL clu...
https://hub.helm.sh/charts/presslabs/mysql-oper...	0.4.0        	v0.4.0      	A Helm chart for mysql operator</code></pre></div></div></div></section><section id="_helm_charts"><h2>Helm Charts</h2><div class="slide-content"><div class="paragraph"><p>Another way to find Charts is Helm Hub: <a href="https://artifacthub.io/" class="bare">https://artifacthub.io/</a></p></div>
<div class="imageblock"><img src="./images/hub-helm.png" alt="hub helm"></div></div></section><section id="_search_for_specific_charts"><h2>Search for Specific Charts</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm search repo hadoop</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$  helm search repo hadoop                                                                                                                             danno@DannoAir
NAME         	CHART VERSION	APP VERSION	DESCRIPTION
stable/hadoop	1.1.2        	2.9.0      	The Apache Hadoop software library is a framework that al...
stable/luigi 	2.7.5        	2.7.2      	Luigi is a Python module that helps you build complex pip...</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Now you will only see the results that match your filter</td></tr></table></div></div></section><section id="_inspect_your_search_with_show"><h2>Inspect your search with <code>show</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>You can view information about your chart including</p><div class="ulist"><ul><li><p>Maintainers</p></li><li><p>Instructions</p></li><li><p>Values</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm show chart &lt;chart&gt; &lt;flags&gt;</code></pre></div></div></li></ul></div></li></ul></div></div></section><section id="_inspect_your_search_example"><h2>Inspect your Search Example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm show chart stable/hadoop</code></pre></div></div></div></section><section id="_show_chart_results"><h2>Show Chart Results</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">apiVersion: v1
appVersion: 2.9.0
description: The Apache Hadoop software library is a framework that allows for the
  distributed processing of large data sets across clusters of computers using simple
  programming models.
home: https://hadoop.apache.org/
icon: http://hadoop.apache.org/images/hadoop-logo.jpg
maintainers:
- email: disla@google.com
  name: danisla
name: hadoop
sources:
- https://github.com/apache/hadoop
version: 1.1.2</code></pre></div></div></div></section><section id="_view_information_on_a_chart_before_installing"><h2>View information on a chart before installing</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm show chart stable/mysql</code></pre></div></div></div></section><section id="_install_chart"><h2>Install Chart</h2><div class="slide-content"><div class="ulist"><ul><li><p>To install chart, install a chart using either of the following commands</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm install &lt;release-name&gt; &lt;repo&gt;/&lt;name&gt;</code></pre></div></div></li><li><p>To ask Helm to generate a name, albeit boring, use:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm install --generate-name &lt;repo&gt;/&lt;name&gt;</code></pre></div></div></li><li><p>Each release gets its own name</p></li><li><p>Therefore each can be managed separately</p></li></ul></div></div></section><section id="_installing_a_chart_in_a_specific_namespace"><h2>Installing a Chart in a specific namespace</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can install a chart to a specific namespace by using <code>--namespace</code> or <code>-n</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm install &lt;release-name&gt; &lt;repo&gt;/&lt;name&gt; -n marketing</code></pre></div></div></li><li><p>Using <code>--generate-name</code> and <code>--namespace</code> together</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm install --generate-name &lt;repo&gt;/&lt;name&gt; --namespace &lt;namespace&gt;</code></pre></div></div></li></ul></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">The namespace must exist first before installing into a particular namespace</td></tr></table></div></div></section><section id="_dry_run_install_chart"><h2>Dry-Run Install Chart</h2><div class="slide-content"><div class="paragraph"><p>To install chart with a dry run you can run either of the following</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm install --dry-run --debug &lt;release-name&gt; &lt;repo&gt;/&lt;name&gt;</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm install --dry-run --debug --generate-name &lt;repo&gt;/&lt;name&gt;</code></pre></div></div></div></section><section id="_show_all_releases"><h2>Show all releases</h2><div class="slide-content"><div class="ulist"><ul><li><p>The following will list all releases that have been installed with information retained</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm list --all</code></pre></div></div></li><li><p>To show only deployed releases</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm list</code></pre></div></div></li><li><p>To show only deployed releases</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm list</code></pre></div></div></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">You can use <code>helm ls</code> in place of <code>helm list</code></td></tr></table></div></div></section><section id="_show_all_releases_in_a_particular_namespace"><h2>Show all releases in a particular namespace</h2><div class="slide-content"><div class="ulist"><ul><li><p>The following will list all releases in a namespace of your choosing</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm list --all -n &lt;namespace&gt;</code></pre></div></div></li><li><p>To show only deployed releases in a particular namespace</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm list -n &lt;namespace&gt;</code></pre></div></div></li></ul></div></div></section><section id="_determining_the_status"><h2>Determining the Status</h2><div class="slide-content"><div class="ulist"><ul><li><p>Deployments need time to download containers</p></li><li><p>Check the status with the following</p></li><li><p>This will also show a <em>NOTES.txt</em>, basic set of chart instructions</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm status &lt;release-name&gt;</code></pre></div></div></li><li><p>In a particular namespace</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm status &lt;release-name&gt; -n &lt;namespace&gt;</code></pre></div></div></li></ul></div></div></section><section id="_querying_values_to_override"><h2>Querying Values to Override</h2><div class="slide-content"><div class="paragraph"><p>Helm charts are extremely flexible to change configuration, the following command shows values</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm show values &lt;chart&gt;</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm show values stable/mysql</code></pre></div></div></div></section><section id="_showing_values"><h2>Showing Values</h2><div class="slide-content"><div class="paragraph"><p>Values of <code>stable/mysql</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">image: "mysql"
imageTag: "5.7.30"

strategy:
  type: Recreate

busybox:
  image: "busybox"
  tag: "1.32"

testFramework:
  enabled: true
  image: "bats/bats"
  tag: "1.2.1"
  imagePullPolicy: IfNotPresent
  securityContext: {}</code></pre></div></div></div></section><section id="_setting_the_values"><h2>Setting the Values</h2><div class="slide-content"><div class="ulist"><ul><li><p>We can see the values that can be changed using <code>helm show values</code></p></li><li><p>All values can be changed!</p></li><li><p>For Example, given the following values formatted as yaml</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">image: "mysql"
imageTag: "5.7.30"

testFramework:
  enabled: true
  image: "bats/bats"
  tag: "1.2.1"
  imagePullPolicy: IfNotPresent
  securityContext: {}</code></pre></div></div></li><li><p>You can change the <code>imageTag</code> using <code>--set imageTag=5.7.31</code></p></li><li><p>You can change nested elements like the <code>tag</code> in <code>testFramework</code> using <code>--set testFramework.tag=1.2.2</code></p></li></ul></div></div></section><section id="_showing_the_chart"><h2>Showing the Chart</h2><div class="slide-content"><div class="paragraph"><p>To describe the chart:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm show chart stable/mysql</code></pre></div></div>
<div class="paragraph"><p>The results of showing the chart</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
appVersion: 5.7.30
description: Fast, reliable, scalable, and easy to use open-source relational database
  system.
home: https://www.mysql.com/
icon: https://www.mysql.com/common/logos/logo-mysql-170x115.png
keywords:
- mysql
- database
- sql
maintainers:
- email: o.with@sportradar.com
  name: olemarkus
- email: viglesias@google.com
  name: viglesiasce
name: mysql
sources:
- https://github.com/kubernetes/charts
- https://github.com/docker-library/mysql
version: 1.6.7</code></pre></div></div></div></section><section id="_upgrading_the_chart"><h2>Upgrading the Chart</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you need to make a change with the values, or make another adjustment</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm upgrade &lt;release-name&gt; &lt;chart&gt; &lt;flag&gt;</code></pre></div></div></li><li><p>For example:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm upgrade --set imageTag=5.7.30 --set testFramework.tag=1.2.2 \
  galloping-gazelle stable/mysql</code></pre></div></div></li></ul></div></div></section><section id="_upgrading_the_chart_with_a_file"><h2>Upgrading the Chart with a File</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you have your own <em>values.yaml</em> file, you can include it using the <code>-f</code> flag</p></li><li><p>Priority will be given to the right hand flag</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm upgrade -f myvalues.yaml -f override.yaml &lt;release-name&gt; &lt;repo&gt;/&lt;chart&gt;</code></pre></div></div></li></ul></div></div></section><section id="_uninstall_a_release"><h2>Uninstall a release</h2><div class="slide-content"><div class="ulist"><ul><li><p>To uninstall a release simply use <code>uninstall</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm uninstall &lt;release-name&gt;</code></pre></div></div></li><li><p>To uninstall from a namespace use <code>-n</code> or <code>--namespace</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm uninstall &lt;release-name&gt; -n &lt;namespace&gt;</code></pre></div></div></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Use <code>--dry-run</code> switch to see what will be uninstalled with actually uninstalling them</td></tr></table></div></div></section><section id="_uninstall_with_a_history"><h2>Uninstall with a History</h2><div class="slide-content"><div class="ulist"><ul><li><p>Using <code>--keep-history</code> will retain deployment history</p></li><li><p>You can view previous deployments using:</p><div class="ulist"><ul><li><p><code>helm list --uninstalled</code></p></li><li><p><code>helm list --all</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm uninstall --keep-history</code></pre></div></div></li></ul></div></li></ul></div></div></section><section id="_getting_autocomplete_script_help"><h2>Getting Autocomplete Script Help</h2><div class="slide-content"><div class="ulist"><ul><li><p>For Bash:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm completion bash</code></pre></div></div></li><li><p>For ZSH:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm completion zsh</code></pre></div></div></li></ul></div></div></section><section id="_applying_autocomplete_script_help"><h2>Applying Autocomplete Script Help</h2><div class="slide-content"><div class="ulist"><ul><li><p>In order to apply to the current shell session, use a direction arrow to apply through <code>source</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ source &lt;(helm completion zsh)</code></pre></div></div></li><li><p>The <a href="https://helm.sh/docs/helm/helm_completion_zsh/" target="_blank">Website directions</a> mention to use the following, but it may end up messy</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm completion zsh &gt; "${fpath[1]}/_helm"</code></pre></div></div></li></ul></div></div></section><section id="_if_you_are_on_a_mac_and_using_zsh_consider_ohmyzsh"><h2>If you are on a Mac and using ZSH, consider OhMyZSH!</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://ohmyz.sh" target="_blank">OhMyZSH</a> is a open source shell enhancement</p></li><li><p>You can use themes for your shell</p></li><li><p>And contains autocompletions for many application you constantly use</p></li></ul></div>
<div class="imageblock"><img src="./images/ohmyzsh.png" alt="ohmyzsh"></div></div></section><section id="_adding_plugins_to_ohmyzsh"><h2>Adding Plugins to OhMyZSH</h2><div class="slide-content"><div class="ulist"><ul><li><p>Once you have OhMyZSH installed, edit your <em>.zshrc</em> file</p></li><li><p>Locate the <code>plugins</code> attribute, and add the plugins you use</p></li><li><p>Find more plugins at the <a href="https://github.com/ohmyzsh/ohmyzsh/wiki/Plugins" target="_blank">OhMyZSH website</a></p><div class="listingblock"><div class="title">Snippet of the contents in <em>~/.zshrc</em></div><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell"># Which plugins would you like to load? (plugins can be found in ~/.oh-my-zsh/plugins/*)
# Custom plugins may be added to ~/.oh-my-zsh/custom/plugins/
# Example format: plugins=(rails git textmate ruby lighthouse)
# Add wisely, as too many plugins slow down shell startup.
plugins=(git z docker docker-compose kubectl sdk vault helm)</code></pre></div></div></li></ul></div></div></section><section id="_getting_help"><h2>Getting Help</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm get -h</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">$ helm ls -h</code></pre></div></div></div></section></section>
<section id="_lab_1_install_chart"><h2>Lab 1: Install Chart</h2><div class="slide-content"><div class="paragraph"><p>Open your lab book, <em>lab_book.html</em>, and do "Lab 1: Install a public chart"</p></div></div></section>
<section><section id="_yaml"><h2>YAML</h2></section><section id="_yaml_primer"><h2>YAML Primer</h2><div class="slide-content"><div class="ulist"><ul><li><p>Let&#8217;s get an understanding quickly of the YAML Specification</p></li><li><p>Visit <a href="https://yaml.org/spec/" target="_blank">The full YAML Specification</a> for more information</p></li></ul></div>
<div class="openblock listingblock"><div class="content"><div class="paragraph"><p>Source: <a href="https://v2.helm.sh/docs/chart_template_guide/#yaml-techniques" class="bare">https://v2.helm.sh/docs/chart_template_guide/#yaml-techniques</a></p></div></div></div></div></section><section id="_yaml_list"><h2>YAML List</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">sequence:
  - one
  - two
  - three</code></pre></div></div></div></section><section id="_yaml_map"><h2>YAML Map</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">map:
  one: 1
  two: 2
  three: 3</code></pre></div></div></div></section><section id="_integer_scalars"><h2>Integer Scalars</h2><div class="slide-content"><div class="ulist"><ul><li><p>If an integer or float is an unquoted bare word, it is typically treated as a numeric type</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">count: 1
size: 2.34</code></pre></div></div></li><li><p>If they are quoted, they are treated as strings:</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">count: "1" # &lt;-- string, not int
size: '2.34' # &lt;-- string, not float</code></pre></div></div></li></ul></div></div></section><section id="_boolean_scalars"><h2>Boolean Scalars</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">isGood: true   # bool
answer: "true" # string</code></pre></div></div></div></section><section id="_null"><h2><code>null</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">isAvailable: null</code></pre></div></div></div></section><section id="_coercing_yaml_values"><h2>Coercing YAML Values</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can coerce YAML values using <code>!!</code></p></li><li><p>Below:</p><div class="ulist"><ul><li><p><code>!!str</code> tells the parser that age is a string, even if it looks like an <code>int</code>.</p></li><li><p><code>port</code> is treated as an <code>int</code>, even though it is quoted.</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">coffee: "yes, please"
age: !!str 21
port: !!int "80"</code></pre></div></div></li></ul></div></li></ul></div></div></section><section id="_yaml_strings"><h2>YAML Strings</h2><div class="slide-content"><div class="ulist"><ul><li><p>Three inline ways to declare a string</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">way1: bare words
way2: "double-quoted strings"
way3: 'single-quoted strings'</code></pre></div></div></li><li><p>Bare words are unquoted, and are not escaped. For this reason, you have to be careful what characters you use.</p></li><li><p>Double-quoted strings can have specific characters escaped with <code>\</code>.</p><div class="ulist"><ul><li><p>For example <code>"\"Hello\", she said"</code>.</p></li><li><p>You can escape line breaks with <code>\n</code>.</p></li></ul></div></li><li><p>Single-quoted strings are “literal” strings, and do not use the <code>\</code> to escape characters.</p><div class="ulist"><ul><li><p>The only escape sequence is <code>''</code>, which is decoded as a single <code>'</code>.</p></li></ul></div></li></ul></div></div></section><section id="_multiline_strings"><h2>Multiline Strings</h2><div class="slide-content"><div class="ulist"><ul><li><p>Multiline strings can be declared using <code>|</code></p></li><li><p>The following is equivalent to: <code>Latte\nCappuccino\nEspresso\n</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">coffee: |
  Latte
  Cappuccino
  Espresso</code></pre></div></div></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">The first line has be correctly indented</td></tr></table></div></div></section><section id="_multiline_with_trimming"><h2>Multiline with Trimming</h2><div class="slide-content"><div class="ulist"><ul><li><p>The previous slide will render a multiline string with an additional newline</p></li><li><p>To trim the extra newline, use a dash <code>-</code></p></li><li><p>The following is equivalent to: <code>Latte\nCappuccino\nEspresso</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">coffee: |-
  Latte
  Cappuccino
  Espresso</code></pre></div></div></li></ul></div></div></section><section id="_indentation_is_preserved"><h2>Indentation is Preserved</h2><div class="slide-content"><div class="ulist"><ul><li><p>Indentation inside of a text block is preserved, this includes line breaks</p></li><li><p>In the following, <code>coffee</code> is <code>Latte\n 12 oz\n 16 oz\nCappuccino\nEspresso</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">coffee: |-
  Latte
    12 oz
    16 oz
  Cappuccino
  Espresso</code></pre></div></div></li></ul></div></div></section><section id="_maintaining_all_trailing_whitespaces"><h2>Maintaining all Trailing Whitespaces</h2><div class="slide-content"><div class="ulist"><ul><li><p>Using <code>|+</code> maintains all trailing whitespace</p></li><li><p>The following evaluates to: <code>Latte\nCappuccino\nEspresso\n\n\n</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">coffee: |+
  Latte
  Cappuccino
  Espresso


another: value</code></pre></div></div></li></ul></div></div></section><section id="_folded_multiline_strings"><h2>Folded Multiline Strings</h2><div class="slide-content"><div class="ulist"><ul><li><p>Sometimes you want to represent a string in your YAML with multiple lines, but want it to be treated as one long line.</p></li><li><p>This is called “folding”.</p></li><li><p>To declare a folded block, use <code>&gt;</code> instead of <code>|</code></p></li><li><p>The following will render <code>coffee</code> as <code>Latte Cappuccino Espresso\n</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">coffee: &gt;
  Latte
  Cappuccino
  Espresso</code></pre></div></div></li></ul></div></div></section><section id="_folding_and_trimming"><h2>Folding and Trimming</h2><div class="slide-content"><div class="ulist"><ul><li><p>Given the previous slide, it still maintains the last <code>\n</code></p></li><li><p>We can then use <code>&gt;-</code> to fold and trim all the newlines</p></li><li><p>The following produces for <code>coffee</code>: <code>Latte\n 12 oz\n 16 oz\nCappuccino Espresso</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">coffee: &gt;-
  Latte
    12 oz
    16 oz
  Cappuccino
  Espresso</code></pre></div></div></li></ul></div></div></section><section id="_embedding_multiple_documents"><h2>Embedding Multiple Documents</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can embed multiple yaml files in a single file</p></li><li><p>This is done by prefixing: <code><em>_</em></code>, and ending with <code>&#8230;&#8203;</code></p></li><li><p>In many cases they can be omitted since it would be up to the parser</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">---
document:1
...
---
document: 2
...</code></pre></div></div></div></section><section id="_yaml_anchors"><h2>YAML Anchors</h2><div class="slide-content"><div class="ulist"><ul><li><p>YAML spec provides a way to store a reference to a value and later refer to that value by reference.</p></li><li><p>YAML refers to this as “anchoring”</p></li><li><p>Use <code>&amp;</code> as the reference</p></li><li><p>Use <code>*</code> as the pointer</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">coffee: "yes, please"
favorite: &amp;favoriteCoffee "Cappucino"
coffees:
  - Latte
  - *favoriteCoffee
  - Espresso</code></pre></div></div></li></ul></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">References are expanded and then discarded. The anchors in Helm and K8s will be lost</td></tr></table></div></div></section></section>
<section><section id="_create_basic_chart"><h2>Create Basic Chart</h2><div class="slide-content"><div class="paragraph"><p>Agenda:</p></div><div class="ulist"><ul><li><p>Creating a chart</p></li><li><p>Understanding templates</p></li><li><p>Performing Dry Runs</p></li><li><p>Understanding Values</p></li></ul></div></div></section><section id="_creating_a_chart"><h2>Creating a Chart</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm create mychart</code></pre></div></div>
<div class="paragraph"><p>This will create:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">.
└── mychart
    ├── Chart.yaml
    ├── charts
    ├── templates
    │   ├── NOTES.txt
    │   ├── _helpers.tpl
    │   ├── deployment.yaml
    │   ├── ingress.yaml
    │   ├── service.yaml
    │   ├── serviceaccount.yaml
    │   └── tests
    │       └── test-connection.yaml
    └── values.yaml</code></pre></div></div></div></section><section id="_chart_yaml"><h2><code>Chart.yaml</code></h2><div class="slide-content"><div class="paragraph"><p>A default YAML file containing information about the chart</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
appVersion: "1.0"
description: A Helm chart for Kubernetes
name: mychart
version: 0.1.0</code></pre></div></div></div></section><section id="_mandatory_fields_in_chart_yaml"><h2>Mandatory Fields in <em>Chart.yaml</em></h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Key</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>apiVersion</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Chart API version</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>appVersion</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Version that app contains</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Single sentence description</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Name of the project</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>SemVer 2 version</p></div></div></td></tr></table></div></section><section id="_charts_directory"><h2><code>charts</code> Directory</h2><div class="slide-content"><div class="paragraph"><p>The <code>charts</code> directory is a directory containing any charts upon which this chart depends</p></div></div></section><section id="_templates_directory"><h2><code>templates</code> Directory</h2><div class="slide-content"><div class="paragraph"><p>A directory of templates that, when combined with values, will generate valid Kubernetes manifest files</p></div>
<div class="ulist"><ul><li><p><code>_helpers.tpl</code> - helper templates</p></li><li><p>Kubernetes files</p></li><li><p>tests - unit</p></li></ul></div></div></section><section id="_additional_fields"><h2>Additional Fields</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Key</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubeVersion</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>SemverRange of compatible K8s versions</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>keywords</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>List of keywords</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>home</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Project&#8217;s Home Page</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>sources</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>List of URLs of source code</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>maintainers</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>List of maintainers (see maintainer object)</p></div></div></td></tr></table></div></section><section id="_additional_fields_continued"><h2>Additional Fields Continued</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Key</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>engine</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Name of the template engine; default: Go Template Engine</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>icon</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>SVG or PNG representing the chart</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>deprecated</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Whether this chart is deprecated</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>tillerVersion</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Version of Tiller (Semver)</p></div></div></td></tr></table></div></section><section id="_maintainers"><h2>Maintainers:</h2><div class="slide-content"><div class="paragraph"><p>The maintainers, previous slide looks like the following</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Key</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Maintainer&#8217;s name</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>email</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Maintainer&#8217;s email</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Maintainer&#8217;s url</p></div></div></td></tr></table></div></section><section id="_semver_standard"><h2>SemVer Standard</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://semver.org/" class="bare">https://semver.org/</a></p></li><li><p>Given a version number <code>MAJOR.MINOR.PATCH</code>, increment the:</p><div class="ulist"><ul><li><p><code>MAJOR</code> version when you make incompatible API changes,</p></li><li><p><code>MINOR</code> version when you add functionality in a backwards compatible manner, and</p></li><li><p><code>PATCH</code> version when you make backwards compatible bug fixes.</p></li><li><p>Additional labels for pre-release and build metadata are available as extensions to the <code>MAJOR.MINOR.PATCH</code> format.</p></li></ul></div></li><li><p>There are additional rules, see website for details</p></li></ul></div></div></section><section id="_charts_and_versioning"><h2>Charts and Versioning</h2><div class="slide-content"><div class="ulist"><ul><li><p>Versions must follow SemVer2 Versioning</p></li><li><p>Example the tar ball that represents nginx, given the name <code>nginx</code> and version <code>1.2.3</code></p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-noescape="true" data-lang="text">nginx-1.2.3.tgz</code></pre></div></div></li><li><p>Version field is in the <em>Chart.yml</em> is used by various tools. All version numbers <em>must match</em>.</p></li></ul></div></div></section><section id="_appversion"><h2><code>appVersion</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>App version is for users' use, purely informational</p></li><li><p>Doesn&#8217;t follow SemVer rules</p></li></ul></div></div></section><section id="_deprecating_charts"><h2>Deprecating Charts</h2><div class="slide-content"><div class="ulist"><ul><li><p>The optional <code>deprecated</code> field in <em>Chart.yaml</em> can be used to mark a chart as deprecated</p></li><li><p>If the latest version of a chart in the repository is marked as deprecated, then the chart as a whole is considered to be deprecated.</p></li><li><p>The chart name can later be reused by publishing a newer version that is not marked as <code>deprecated</code></p></li></ul></div></div></section><section id="_license_readme_notes_txt"><h2><em>LICENSE</em>, <em>README, _Notes.txt</em></h2><div class="slide-content"><div class="ulist"><ul><li><p><em>LICENSE</em> is the licensing used in Helm</p></li><li><p><em>README</em> is Markdown information on how to use the chart, <em>before installation</em></p></li><li><p><em>template/NOTES.txt</em> used to display the status of the release when using <code>helm package</code> or <code>helm status</code>, <em>after installation</em></p></li></ul></div></div></section><section id="_helmignore_file"><h2><em>.helmignore</em> File</h2><div class="slide-content"><div class="ulist"><ul><li><p>Used to specify files you don’t want to include in your helm chart.</p></li><li><p>If the file exists, the <code>helm package</code> (used to package for distribution) command will ignore all the files that match the pattern specified in the <em>.helmignore</em> file while packaging your application.</p></li><li><p>This can help in avoiding unnecessary or sensitive files or directories from being added in your helm chart.</p></li><li><p>The <em>.helmignore</em> file supports Unix shell glob matching, relative path matching, and negation (prefixed with !).</p></li><li><p>Only one pattern per line is considered.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-property hljs" data-noescape="true" data-lang="property"># comment
.git
*/temp*
*/*/temp*
temp?</code></pre></div></div></div></section><section id="_debugging_templates"><h2>Debugging Templates</h2><div class="slide-content"><div class="ulist"><ul><li><p>While things may look well on the client</p></li><li><p>When it is sent to the Kubernetes API, it may reject</p></li><li><p>To help debug, you can use the following:</p><div class="ulist"><ul><li><p><code>helm lint</code> is your go-to tool for verifying that your chart follows best practices</p></li><li><p><code>helm install --dry-run --debug</code> render your templates and eyeball the results</p></li><li><p><code>helm get manifest</code> see what templates have already been installed on the server</p></li></ul></div></li></ul></div></div></section></section>
<section id="_lab_2_create_a_basic_chart"><h2>Lab 2: Create a Basic Chart</h2><div class="slide-content"><div class="paragraph"><p>Open your lab book, <em>lab_book.html</em>, and do "Lab 2: Create a basic chart"</p></div></div></section>
<section><section id="_chart_dependencies"><h2>Chart Dependencies</h2></section><section id="_establishing_chart_dependencies"><h2>Establishing Chart Dependencies</h2><div class="slide-content"><div class="ulist"><ul><li><p><em>Chart.yaml</em> is used to link one chart with another chart</p></li><li><p>Include other dependencies using the <code>dependencies</code> section</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">dependencies:
- name: apache
  version: 1.2.3
  repository: http://example.com/charts
- name: mysql
  version: 3.2.1
  repository: http://another.example.com/charts</code></pre></div></div></li><li><p>The <code>name</code> field is the name of the chart you want.</p></li><li><p>The <code>version</code> field is the version of the chart you want.</p></li><li><p>The <code>repository</code> field is the full URL to the chart repository.</p></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">You must also use <code>helm repo add</code> to add that repository locally.</td></tr></table></div></div></section><section id="_downloading_dependencies"><h2>Downloading Dependencies</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm dependency up my-chart
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "local" chart repository
...Successfully got an update from the "stable" chart repository
...Successfully got an update from the "example" chart repository
...Successfully got an update from the "another" chart repository
Update Complete.
Saving 2 charts
Downloading apache from repo http://example.com/charts
Downloading mysql from repo http://another.example.com/charts</code></pre></div></div></div></section><section id="_how_dependencies_are_stored"><h2>How Dependencies are Stored</h2><div class="slide-content"><div class="paragraph"><p>The tarballs will be installed in the <em>charts/</em> directory</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">charts/
  apache-1.2.3.tgz
  mysql-3.2.1.tgz</code></pre></div></div></div></section><section id="_using_alias"><h2>Using <code>alias</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Use <code>alias</code> in cases where they need to access a chart with other name</p></li><li><p>The following is using the <em>same chart</em> three different times</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">dependencies:
- name: subchart
  repository: http://localhost:10191
  version: 0.1.0
  alias: new-subchart-1
- name: subchart
  repository: http://localhost:10191
  version: 0.1.0
  alias: new-subchart-2
- name: subchart
  repository: http://localhost:10191
  version: 0.1.0</code></pre></div></div></div></section><section id="_alias_results"><h2><code>alias</code> Results</h2><div class="slide-content"><div class="paragraph"><p>The previous slide creates:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">subchart
new-subchart-1
new-subchart-2</code></pre></div></div></div></section><section id="_using_conditions"><h2>Using Conditions</h2><div class="slide-content"><div class="ulist"><ul><li><p>The condition field holds one or more YAML paths (delimited by commas).</p></li><li><p>If this path exists in the <em>parent’s values</em> and resolves to a boolean value,</p></li><li><p>the chart will be enabled or disabled based on that boolean value.</p></li><li><p>Only the first valid path found in the list is evaluated and if no paths exist then the condition has no effect.</p></li><li><p>For multiple level dependencies the condition is prepended by the path to the parent chart.</p></li></ul></div></div></section><section id="_using_tags"><h2>Using Tags</h2><div class="slide-content"><div class="ulist"><ul><li><p>The tags field is a YAML list of labels to associate with this chart.</p></li><li><p>In the top parent’s values, all charts with tags can be enabled or disabled by specifying the tag and a boolean value.</p></li></ul></div></div></section><section id="_parent_chart"><h2>Parent Chart</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># parentchart/Chart.yaml
dependencies:
  - name: subchart1
    repository: http://localhost:10191
    version: 0.1.0
    condition: subchart1.enabled
    tags:
      - front-end
      - subchart1

  - name: subchart2
    repository: http://localhost:10191
    version: 0.1.0
    condition: subchart2.enabled
    tags:
      - back-end
      - subchart2</code></pre></div></div></div></section><section id="_subchart_2_requirements"><h2>Subchart 2 Requirements</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># subchart2/Chart.yaml
dependencies:
  - name: subsubchart
    repository: http://localhost:10191
    version: 0.1.0
    condition: subsubchart.enabled</code></pre></div></div></div></section><section id="_parent_chart_values"><h2>Parent Chart Values</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">subchart1:
  enabled: true
subchart2:
  subsubchart:
    enabled: false
tags:
  front-end: false
  back-end: true</code></pre></div></div>
<div class="ulist"><ul><li><p>All charts with <code>front-end</code> would be disabled, but</p></li><li><p>Conditions override tags, <code>subchart1</code> is enabled, therefore <code>subchart1</code> is enabled.</p></li></ul></div></div></section><section id="_tags_conditions"><h2>Tags &amp; Conditions</h2><div class="slide-content"><div class="ulist"><ul><li><p>Conditions (when set in values) always override tags.</p></li><li><p>The first condition path that exists wins and subsequent ones for that chart are ignored.</p></li><li><p>Tags and conditions values must be set in the top parent’s <em>values.yaml</em>.</p></li></ul></div></div></section></section>
<section id="_lab_3_dependencies"><h2>Lab 3: Dependencies</h2><div class="slide-content"><div class="paragraph"><p>Open your lab book, <em>lab_book.html</em>, and do "Lab 3: Dependencies"</p></div></div></section>
<section><section id="_templates"><h2>Templates</h2></section><section id="_creating_chart"><h2>Creating <code>chart</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% helm create chart</code></pre></div></div>
<div class="paragraph"><p>Creates the following directory</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">mychart/
  Chart.yaml
  values.yaml
  charts/
  templates/
  ...</code></pre></div></div></div></section><section id="_about_templates"><h2>About Templates</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>templates</code> directory contain the template files</p></li><li><p>All the files in the <code>templates</code> directory will go through the template rendering engine</p></li><li><p>It collects the results and sends it through Kubernetes</p></li></ul></div></div></section><section id="_values_yaml"><h2><code>values.yaml</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Contains default values for charts</p></li><li><p>Then can be overriden by</p><div class="ulist"><ul><li><p><code>helm install</code></p></li><li><p><code>helm upgrade</code></p></li></ul></div></li></ul></div></div></section><section id="_chart_yaml_2"><h2><code>Chart.yaml</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Contains a description of the chart</p></li><li><p>It can be accessed from the template</p></li><li><p>Charts can create other charts called <em>subcharts</em></p></li></ul></div></div></section><section id="_inside_templates"><h2>Inside <code>templates</code></h2><div class="slide-content"><div class="ulist"><ul><li><p><code>NOTES.txt</code> - "Help text" - Displayed when they run <code>helm install</code></p></li><li><p><code>deployment.yaml</code> - A basic manifest for creating a Kubernetes deployment</p></li><li><p><code>service.yaml</code> - A basic manifest for creating a service endpoint for your deployment</p></li><li><p><code>_helpers.tpl</code>: A place to put template helpers that you can re-use throughout the chart</p></li></ul></div></div></section><section id="_example_template"><h2>Example <code>template</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: mychart-configmap
data:
  myvalue: "Hello World"</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Convention, use <code>.yaml</code> extension for yaml files, and <code>.tpl</code> for helpers</td></tr></table></div></div></section><section id="_viewing_the_template"><h2>Viewing the template</h2><div class="slide-content"><div class="paragraph"><p>We can install it using <code>helm install mychart</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% helm install --generate-name ./mychart

NAME: full-coral
LAST DEPLOYED: Tue Nov  1 17:36:01 2016
NAMESPACE: default
STATUS: DEPLOYED

RESOURCES:
==&gt; v1/ConfigMap
NAME                DATA      AGE
mychart-configmap   1         1m</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content"><code>full-coral</code> is the release name, it is either manually created or chosen randomly</td></tr></table></div></div></section><section id="_retrieving_the_release"><h2>Retrieving the Release</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% helm get manifest full-coral

---
# Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: mychart-configmap
data:
  myvalue: "Hello World"</code></pre></div></div></div></section><section id="_setting_a_release_name"><h2>Setting a Release Name</h2><div class="slide-content"><div class="ulist"><ul><li><p>Best Practice is the replace the <code>Name:</code> field</p></li><li><p>We can create a Template call of the name</p></li><li><p>The dots are called <em>namespace objects</em></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"</code></pre></div></div></div></section><section id="_running_the_template"><h2>Running the Template</h2><div class="slide-content"><div class="ulist"><ul><li><p>Installing the chart</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% helm install ./mychart</code></pre></div></div>
<div class="ulist"><ul><li><p>Getting the Manifest</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% helm get manifest ./mychart</code></pre></div></div></div></section><section id="_debugging_the_content"><h2>Debugging the Content</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% helm install ./mychart --debug --dry-run</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content"><code>--dry-run</code> will make it easier to test your code</td></tr></table></div></div></section><section id="_using_helm_playground"><h2>Using <a href="https://helm-playground.com/" target="_blank">Helm Playground</a></h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://helm-playground.com/" target="_blank">Helm Playground</a> is a website to experiment with charts</p></li><li><p>It provides instance feedback for chart development</p></li><li><p>It is divided by:</p><div class="ulist"><ul><li><p><em>template.yaml</em> which is the template</p></li><li><p><em>values.yaml</em> the values file</p></li><li><p><strong>output</strong> The rendering by combining the two</p></li></ul></div></li></ul></div>
<div class="imageblock"><img src="./images/helm-playground.png" alt="helm playground"></div></div></section><section id="_objects"><h2>Objects</h2><div class="slide-content"><div class="ulist"><ul><li><p>Passed into the template engine</p></li><li><p>Can be created within the template engine</p></li><li><p>Can simple with one value</p></li><li><p>Contain other objects and functions</p></li></ul></div></div></section><section id="_release_object"><h2><code>Release</code> Object</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>Release</code>: This object describes the release itself. It has several objects inside of it:</p></li><li><p><code>Release.Name</code>: The release name</p></li><li><p><code>Release.Time</code>: The time of the release</p></li><li><p><code>Release.Namespace</code>: The namespace to be released into (if the manifest doesn’t override)</p></li><li><p><code>Release.Service</code>: The name of the releasing service (always <code>Helm</code>).</p></li><li><p><code>Release.Revision</code>: The revision number of this release. It begins at 1 and is incremented for each helm upgrade.</p></li><li><p><code>Release.IsUpgrade</code>: This is set to true if the current operation is an upgrade or rollback.</p></li><li><p><code>Release.IsInstall</code>: This is set to true if the current operation is an install.</p></li></ul></div></div></section><section id="_values_object"><h2><code>Values</code> Object</h2><div class="slide-content"><div class="ulist"><ul><li><p>Values passed into the template from</p><div class="ulist"><ul><li><p>The <em>values.yaml</em> file</p></li><li><p>From user-supplied files.</p></li><li><p>By default, <code>Values</code> is empty.</p></li></ul></div></li></ul></div></div></section><section id="_chart_object"><h2><code>Chart</code> Object</h2><div class="slide-content"><div class="ulist"><ul><li><p>The contents of the <em>Chart.yaml</em> file</p></li><li><p>Any data in Chart.yaml will be accessible here</p></li><li><p>e.g. <code>{{.Chart.Name}}-{{.Chart.Version}}</code></p></li></ul></div></div></section><section id="_files_object"><h2><code>Files</code> Object</h2><div class="slide-content"><div class="ulist"><ul><li><p>This provides access to all non-special files in a chart.</p></li><li><p>While you cannot use it to access templates, you can use it to access other files in the chart.</p></li><li><p><code>Files.Get</code> is a function for getting a file by name (<code>.Files.Get config.ini</code>)</p></li><li><p><code>Files.GetBytes</code> is a function for getting the contents of a file as an array of bytes instead of as a string.</p></li></ul></div></div></section><section id="_capabilities"><h2><code>Capabilities</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>This provides information about what capabilities the Kubernetes cluster supports</p></li><li><p><code>Capabilities.APIVersions</code>- Set of versions.</p></li><li><p><code>Capabilities.APIVersions.Has $version</code> -</p><div class="ulist"><ul><li><p>Indicates whether a version (e.g., <code>batch/v1</code>) or resource (e.g., <code>apps/v1/Deployment</code>) is available on the cluster.</p></li></ul></div></li><li><p><code>Capabilities.KubeVersion</code></p><div class="ulist"><ul><li><p>Provides a way to look up the Kubernetes version.</p></li><li><p>It has the following values: <code>Major</code>, <code>Minor</code>, <code>GitVersion</code>, <code>GitCommit</code>, <code>GitTreeState</code>, <code>BuildDate</code>, <code>GoVersion</code>, <code>Compiler</code>, and <code>Platform</code>.</p></li></ul></div></li></ul></div></div></section><section id="_template"><h2><code>Template</code></h2><div class="slide-content"><div class="paragraph"><p>Contains information about the current template that is being executed</p></div>
<div class="ulist"><ul><li><p><code>Name</code> - A namespaced filepath to the current template (e.g. <code>mychart/templates/mytemplate.yaml</code>)</p></li><li><p><code>BasePath</code> - The namespaced path to the templates directory of the current chart (e.g. <code>mychart/templates</code>)</p></li></ul></div></div></section><section id="_convention_spelling"><h2>Convention Spelling</h2><div class="slide-content"><div class="ulist"><ul><li><p>Choose lower case for <code>Values</code> objects</p></li><li><p>Reserve upper case for built-in objects</p></li></ul></div></div></section><section id="_values_files"><h2>Values Files</h2><div class="slide-content"><div class="paragraph"><p>Values comes from the following in descending order:</p></div>
<div class="ulist"><ul><li><p>The <em>values.yaml</em> file in the chart</p></li><li><p>If this is a subchart, the <em>values.yaml</em> file of a parent chart</p></li><li><p>A values file is passed into helm install or helm upgrade with the <code>-f</code> flag (<code>helm install -f myvals.yaml ./mychart</code>)</p></li><li><p>Individual parameters passed with <code>--set</code> (such as <code>helm install --set foo=bar ./mychart</code>)</p></li></ul></div></div></section><section id="_example_of_getting_an_attribute"><h2>Example of getting an attribute</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  drink: {{ .Values.favoriteDrink }}</code></pre></div></div></div></section><section id="_rendering_the_attribute"><h2>Rendering the attribute</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: geared-marsupi-configmap
data:
  myvalue: "Hello World"
  drink: coffee</code></pre></div></div></div></section><section id="_overriding_the_attribute"><h2>Overriding the Attribute</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% helm install --dry-run --debug --set favoriteDrink=slurm ./mychart</code></pre></div></div>
<div class="paragraph"><p>Renders:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: solid-vulture-configmap
data:
  myvalue: "Hello World"
  drink: slurm</code></pre></div></div></div></section><section id="_multi_level_values_yaml"><h2>Multi-level Values.yaml</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">favorite:
  drink: coffee
  food: pizza</code></pre></div></div>
<div class="paragraph"><p>Using the template:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  drink: {{ .Values.favorite.drink }}
  food: {{ .Values.favorite.food }}</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Keep trees shallow in <code>values.yaml</code> as much as possible</td></tr></table></div></div></section><section id="_deleting_a_default_key"><h2>Deleting a default key</h2><div class="slide-content"><div class="paragraph"><p>To delete a key, override the value with <code>null</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">livenessProbe:
  httpGet:
    path: /user/login
    port: http</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-noescape="true" data-lang="shell">% helm install ./chart --set livenessProbe.httpGet=null</code></pre></div></div></div></section></section>
<section id="_lab_4_templatizing"><h2>Lab 4: Templatizing</h2><div class="slide-content"><div class="paragraph"><p>Open your lab book, <em>lab_book.html</em>, and do "Lab 4: Templatizing"</p></div></div></section>
<section><section id="_functions"><h2>Functions</h2><div class="slide-content"><div class="ulist"><ul><li><p>Allows us to transform the values</p></li><li><p>Works much like functional programming</p></li><li><p>Functions work with the syntax: <code>functionName arg1 arg2&#8230;&#8203;</code></p></li></ul></div></div></section><section id="_quote"><h2><code>quote</code></h2><div class="slide-content"><div class="paragraph"><p>Places a quote (<code>"</code>) around the food when evaluated</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  drink: {{ .Values.favorite.drink | quote }}
  food: {{ .Values.favorite.food | quote }}</code></pre></div></div></div></section><section id="_rendering_quote"><h2>Rendering <code>quote</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: trendsetting-p-configmap
data:
  myvalue: "Hello World"
  drink: "coffee"
  food: "PIZZA"</code></pre></div></div></div></section><section id="_over_60_functions_available"><h2>Over 60 Functions Available</h2><div class="slide-content"><div class="paragraph"><p>Functions are available:</p></div>
<div class="ulist"><ul><li><p><a href="https://helm.sh/docs/chart_template_guide/function_list/" target="_blank">Helm Standard Functions</a></p></li><li><p><a href="https://godoc.org/text/template" target="_blank">Go Template Library</a></p></li><li><p><a href="http://masterminds.github.io/sprig/" target="_blank">Sprig template library</a></p></li></ul></div></div></section><section id="_pipelines"><h2>Pipelines</h2><div class="slide-content"><div class="ulist"><ul><li><p>Analogous to Pipeline in UNIX shell scripting</p></li><li><p>Each function is applied to the tail to perform actions</p></li><li><p>The following is equivalent to the previous slide</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  drink: {{ .Values.favorite.drink | quote }}
  food: {{ .Values.favorite.food | quote }}</code></pre></div></div></div></section><section id="_chaining_multiple_pipelines"><h2>Chaining Multiple Pipelines</h2><div class="slide-content"><div class="paragraph"><p>The following will convert <code>favorite.food</code> to upper case and then add a quote</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  drink: {{ .Values.favorite.drink | quote }}
  food: {{ .Values.favorite.food | upper | quote }}</code></pre></div></div></div></section><section id="_rendering_quote_and_upper"><h2>Rendering <code>quote</code> and <code>upper</code></h2><div class="slide-content"><div class="paragraph"><p>Here is the result:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: trendsetting-p-configmap
data:
  myvalue: "Hello World"
  drink: "coffee"
  food: "PIZZA"</code></pre></div></div></div></section><section id="_ordering_does_matter"><h2>Ordering does Matter</h2><div class="slide-content"><div class="paragraph"><p>Getting the order down is important, determine the following:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  drink: {{ .Values.favorite.drink | repeat 5 | quote }}
  food: {{ .Values.favorite.food | upper | quote }}</code></pre></div></div></div></section><section id="_answer_ordering_does_matter"><h2>Answer: Ordering does Matter</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: melting-porcup-configmap
data:
  myvalue: "Hello World"
  drink: "coffeecoffeecoffeecoffeecoffee"
  food: "PIZZA"</code></pre></div></div></div></section><section id="_default_function"><h2><code>default</code> function</h2><div class="slide-content"><div class="ulist"><ul><li><p>The default function is: <code>default DEFAULT_VALUE GIVEN_VALUE</code></p></li><li><p>Running it will provide us with the following:</p></li><li><p>Although works with static values, works well with functions</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">drink: {{ .Values.favorite.drink | default "tea" | quote }}</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: virtuous-mink-configmap
data:
  myvalue: "Hello World"
  drink: "coffee"
  food: "PIZZA"</code></pre></div></div></div></section><section id="_removing_coffee"><h2>Removing <code>coffee</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: fair-worm-configmap
data:
  myvalue: "Hello World"
  drink: "tea"
  food: "PIZZA"</code></pre></div></div></div></section><section id="_operators"><h2>Operators</h2><div class="slide-content"><div class="ulist"><ul><li><p>Operators that return a boolean value. To use <code>eq</code>, <code>ne</code>, <code>lt</code>, <code>gt</code>, <code>and</code>, <code>or</code>, <code>not</code></p></li><li><p>To chain operators, separate by surrounding them with parenthesis</p></li></ul></div>
<div class="listingblock"><div class="title"><code>and</code> and <code>eq</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">(and .Values.fooString (eq .Values.fooString "foo"))</code></pre></div></div>
<div class="listingblock"><div class="title"><code>or</code> and <code>not</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">(or .Values.anUnsetVariable (not .Values.aSetVariable))</code></pre></div></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content"><code>and</code> and <code>or</code> functions are <em>not</em> short circuited and will require <code>if</code> if you are needed to check for nulls. <code>if</code> is covered next</td></tr></table></div></div></section><section id="_flow_control"><h2>Flow Control</h2><div class="slide-content"><div class="paragraph"><p>We will cover basic flow control:</p></div>
<div class="ulist"><ul><li><p><code>if</code>/<code>else</code> for creating conditional blocks</p></li><li><p><code>with</code> to specify a scope</p></li><li><p><code>range</code>, which provides a “for each”-style loop</p></li></ul></div>
<div class="paragraph"><p>And wade our way into templates</p></div>
<div class="ulist"><ul><li><p><code>define</code> declares a new named template inside of your template</p></li><li><p><code>template</code> imports a named template</p></li><li><p><code>include</code> imports a named template as a function</p></li><li><p><code>block</code> declares a special kind of fillable template area</p></li></ul></div></div></section><section id="_ifelse"><h2><code>if</code>/<code>else</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{ if PIPELINE }}
  # Do something
{{ else if OTHER PIPELINE }}
  # Do something else
{{ else }}
  # Default case
{{ end }}</code></pre></div></div></div></section><section id="_falsy_values"><h2>"Falsy" values</h2><div class="slide-content"><div class="paragraph"><p>A pipeline is <code>false</code> if a value is:</p></div>
<div class="ulist"><ul><li><p>a <code>boolean</code> false</p></li><li><p>a numeric zero</p></li><li><p>an empty string</p></li><li><p>a <code>nil</code> (empty or null)</p></li><li><p>an empty collection (<code>map</code>, <code>slice</code>, <code>tuple</code>, <code>dict</code>, <code>array</code>)</p></li></ul></div></div></section><section id="_ifelse_example"><h2><code>if</code>/<code>else</code> Example</h2><div class="slide-content"><div class="ulist"><ul><li><p>The following checks for an absence of a value</p></li><li><p>The determines the equality using <code>eq</code></p></li><li><p>If so, the create <code>mug:true</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  drink: {{ .Values.favorite.drink | default "tea" | quote }}
  food: {{ .Values.favorite.food | upper | quote }}
  {{ if and .Values.favorite.drink (eq .Values.favorite.drink "coffee") }}mug: true{{ end }}</code></pre></div></div></div></section><section id="_controlling_whitespace"><h2>Controlling Whitespace</h2><div class="slide-content"><div class="ulist"><ul><li><p>The following creates an <code>error converting YAML to JSON</code> error due to indentation</p></li><li><p><code>mug:true</code> is indented too far right, and is an isolated key</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  drink: {{ .Values.favorite.drink | default "tea" | quote }}
  food: {{ .Values.favorite.food | upper | quote }}
  {{if eq .Values.favorite.drink "coffee"}}
    mug: true
  {{end}}</code></pre></div></div></div></section><section id="_rendering_the_extra_space"><h2>Rendering the Extra Space</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">data:
  myvalue: "Hello World"
  drink: "coffee"
  food: "PIZZA"
    mug: true</code></pre></div></div></div></section><section id="_attempt_to_fix_space_error"><h2>Attempt to Fix Space Error</h2><div class="slide-content"><div class="paragraph"><p>As an attempt we could flush the <code>mug:true</code> up to the <code>if</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  drink: {{ .Values.favorite.drink | default "tea" | quote }}
  food: {{ .Values.favorite.food | upper | quote }}
  {{if eq .Values.favorite.drink "coffee"}}
  mug: true
  {{end}}</code></pre></div></div></div></section><section id="_what_that_renders"><h2>What that renders</h2><div class="slide-content"><div class="paragraph"><p>We get an extra carriage return, where the <code>{{if}}</code> would be</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">data:
  myvalue: "Hello World"
  drink: "coffee"
  food: "PIZZA"

  mug: true</code></pre></div></div></div></section><section id="_using_special_curly_braced_syntax"><h2>Using special curly-braced syntax</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>{{-</code> (with the dash and space added) indicates that whitespace should be chomped left</p></li><li><p><code>-}}</code> means whitespace to the right should be consumed.</p></li><li><p>Be careful! Newlines are whitespace!</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  drink: {{ .Values.favorite.drink | default "tea" | quote }}
  food: {{ .Values.favorite.food | upper | quote }}
  {{- if eq .Values.favorite.drink "coffee"}}
  mug: true
  {{- end}}</code></pre></div></div></div></section><section id="_reminder_indent_function"><h2>Reminder: <code>indent</code> function</h2><div class="slide-content"><div class="paragraph"><p>You can apply the same technique with the <code>indent</code> function</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{indent 2 "mug:true"}}</code></pre></div></div></div></section><section id="_modifying_with_with"><h2>Modifying with <code>with</code></h2><div class="slide-content"><div class="ulist"><ul><li><p><code>with</code> is like a mixin in languages like Ruby</p></li><li><p>Provides a way to set a scope from a value, like <code>.Values.favorites</code></p></li><li><p>May seem similar to <code>import static</code> in Java</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{ with PIPELINE }}
  # restricted scope
{{ end }}</code></pre></div></div></div></section><section id="_using_with"><h2>Using <code>with</code></h2><div class="slide-content"><div class="paragraph"><p>Using <code>with</code>, we can reference <code>.drink</code>, <code>.food</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  {{- with .Values.favorite }}
  drink: {{ .drink | default "tea" | quote }}
  food: {{ .food | upper | quote }}
  {{- end }}</code></pre></div></div></div></section><section id="_exiting_the_with_appropriately"><h2>Exiting the <code>with</code> Appropriately</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>Release.Name</code> is not in <code>.Values.favorite</code></p></li><li><p>This will return an error</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{- with .Values.favorite }}
drink: {{ .drink | default "tea" | quote }}
food: {{ .food | upper | quote }}
release: {{ .Release.Name }}
{{- end }}</code></pre></div></div></div></section><section id="_correcting_the_with_error"><h2>Correcting the <code>with</code> error</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{- with .Values.favorite }}
drink: {{ .drink | default "tea" | quote }}
food: {{ .food | upper | quote }}
{{- end }}
release: {{ .Release.Name }}</code></pre></div></div></div></section><section id="_looping_with_range"><h2>Looping with <code>Range</code></h2><div class="slide-content"><div class="paragraph"><p>Given the following, we would like to "iterate" all the pizza toppings</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">favorite:
  drink: coffee
  food: pizza
pizzaToppings:
  - mushrooms
  - cheese
  - peppers
  - onions</code></pre></div></div></div></section><section id="_using_range"><h2>Using <code>Range</code></h2><div class="slide-content"><div class="ulist"><ul><li><p><code>range</code> will iterate over the <code>pizzaToppings</code></p></li><li><p><code>.</code> will represent each value</p></li><li><p><code>{{ . | title | quote }}</code> will send each value into <code>title</code> case and then <code>quote</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">toppings: |-
    {{- range .Values.pizzaToppings }}
    - {{ . | title | quote }}
    {{- end }}</code></pre></div></div></div></section><section id="_result_of_using_range"><h2>Result of using <code>Range</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">toppings: |-
  - "Mushrooms"
  - "Cheese"
  - "Peppers"
  - "Onions"</code></pre></div></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Notice <code>|-</code> is a YAML Multiline String</td></tr></table></div></div></section><section id="_variables"><h2>Variables</h2><div class="slide-content"><div class="ulist"><ul><li><p>Temporary Variables are available</p></li><li><p>Using a previous example that failed because <code>.Release.Name</code> is not in <code>.Values.favorite</code></p></li><li><p>A workaround is to introduce a variable</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{- with .Values.favorite }}
drink: {{ .drink | default "tea" | quote }}
food: {{ .food | upper | quote }}
release: {{ .Release.Name }}
{{- end }}</code></pre></div></div></div></section><section id="_using_variables"><h2>Using Variables</h2><div class="slide-content"><div class="ulist"><ul><li><p>Uses the form <code>$name</code></p></li><li><p>Assigned using a special operator: <code>:=</code></p></li><li><p>Notice the variable is bound <em>before</em> the <code>with</code> block</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  {{- $relname := .Release.Name -}}
  {{- with .Values.favorite }}
  drink: {{ .drink | default "tea" | quote }}
  food: {{ .food | upper | quote }}
  release: {{ $relname }}
  {{- end }}</code></pre></div></div></div></section><section id="_using_sink_variables"><h2>Using Sink Variables</h2><div class="slide-content"><div class="ulist"><ul><li><p>Functions return a value</p></li><li><p>At times you may want to the trap the value</p></li><li><p>This will assign it to a sink, never to be used</p></li><li><p>This is likely to be done to functions that are mutable</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">$_ := set $myDict "name4" "value4"</code></pre></div></div></div></section><section id="_after_running_the_example"><h2>After Running the Example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: viable-badger-configmap
data:
  myvalue: "Hello World"
  drink: "coffee"
  food: "PIZZA"
  release: viable-badger</code></pre></div></div></div></section><section id="_using_variables_with_range"><h2>Using Variables with <code>range</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Variables can be used as an index and value variable for lists</p></li><li><p>Below, <code>index</code> and <code>topping</code> are used to display element number, <code>:</code>, and the element</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">toppings: |-
    {{- range $index, $topping := .Values.pizzaToppings }}
      {{ $index }}: {{ $topping }}
    {{- end }}</code></pre></div></div></div></section><section id="_using_range_for_key_value_pairs"><h2>Using <code>range</code> for Key Value Pairs</h2><div class="slide-content"><div class="ulist"><ul><li><p>Since <code>./Values.favorite</code> are a list of key value pairs, we can iterate</p></li><li><p><code>$key</code> will be <code>drink</code>, <code>$val</code> will be <code>coffee</code>, etc.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  {{- range $key, $val := .Values.favorite }}
  {{ $key }}: {{ $val | quote }}
  {{- end}}</code></pre></div></div></div></section><section id="_result_of_using_range_for_key_value_pairs"><h2>Result of using <code>range</code> for Key Value Pairs</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: eager-rabbit-configmap
data:
  myvalue: "Hello World"
  drink: "coffee"
  food: "pizza"</code></pre></div></div></div></section><section id="_global_variables"><h2>Global Variables</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>$</code> represents the global variable</p></li><li><p>This is useful in a <code>range</code> loop you need a value by navigating from the top</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{- range .Values.tlsSecrets }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .name }}
  labels:
    # Many helm templates would use &lt;code&gt;.&lt;/code&gt; below, but that will not work,
    # however &lt;code&gt;$&lt;/code&gt; will work here
    app.kubernetes.io/name: {{ template "fullname" $ }}
    # I cannot reference .Chart.Name, but I can do $.Chart.Name
    helm.sh/chart: "{{ $.Chart.Name }}-{{ $.Chart.Version }}"
    app.kubernetes.io/instance: "{{ $.Release.Name }}"
    # Value from appVersion in Chart.yaml
    app.kubernetes.io/version: "{{ $.Chart.AppVersion }}"
    app.kubernetes.io/managed-by: "{{ $.Release.Service }}"
type: kubernetes.io/tls
data:
  tls.crt: {{ .certificate }}
  tls.key: {{ .key }}
---
{{- end }}</code></pre></div></div></div></section><section id="_named_templates"><h2>Named Templates</h2><div class="slide-content"><div class="ulist"><ul><li><p>A named template (sometimes called a partial or a subtemplate)</p></li><li><p>A template defined inside of a file, and given a name</p></li><li><p>Declare and manage <code>define</code>, <code>template</code>, <code>include</code> and <code>block</code></p></li></ul></div></div></section><section id="_partials_and_files"><h2>Partials and <code>_</code> Files</h2><div class="slide-content"><div class="ulist"><ul><li><p>We can create named embedded templates, that can be accessed by name elsewhere</p></li><li><p>Some Conventions:</p><div class="ulist"><ul><li><p>Most files in <em>templates/</em> are treated as if they contain Kubernetes manifests</p></li><li><p>The <em>NOTES.txt</em> is one exception</p></li><li><p>Files whose name begins with an underscore (<code>_</code>) are assumed to not have a manifest inside.</p></li></ul></div></li></ul></div></div></section><section id="_declaring_a_template"><h2>Declaring a Template</h2><div class="slide-content"><div class="paragraph"><p>The define action allows us to create a named template inside of a template file.</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{ define "MY.NAME" }}
  # body of template here
{{ end }}</code></pre></div></div></div></section><section id="_example_of_a_template"><h2>Example of a Template</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{- define "mychart.labels" }}
  labels:
    generator: helm
    date: {{ now | htmlDate }}
{{- end }}</code></pre></div></div></div></section><section id="_embedding_a_template"><h2>Embedding a Template</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{- define "mychart.labels" }}
  labels:
    generator: helm
    date: {{ now | htmlDate }}
{{- end }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
  {{- template "mychart.labels" }}
data:
  myvalue: "Hello World"
  {{- range $key, $val := .Values.favorite }}
  {{ $key }}: {{ $val | quote }}
  {{- end }}</code></pre></div></div></div></section><section id="_template_names_are_global"><h2>Template names are global</h2><div class="slide-content"><div class="ulist"><ul><li><p>Template names are global.</p></li><li><p>If you declare two templates with the same name, whichever one is loaded last will be the one used.</p></li><li><p>Convention is to prefix each defined template with name of the chart</p></li><li><p>Using the specific chart name as a prefix we can avoid any conflicts that may arise due to two different charts that implement templates of the same name.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{ define "mychart.labels" }}</code></pre></div></div></div></section><section id="_setting_scope_of_a_template"><h2>Setting scope of a template</h2><div class="slide-content"><div class="paragraph"><p>The following will add <code>Chart</code> <code>Name</code> and <code>Version</code> albeit incorrectly</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{/* Generate basic labels */}}
{{- define "mychart.labels" }}
  labels:
    generator: helm
    date: {{ now | htmlDate }}
    chart: {{ .Chart.Name }}
    version: {{ .Chart.Version }}
{{- end }}</code></pre></div></div></div></section><section id="_what_it_renders"><h2>What it Renders</h2><div class="slide-content"><div class="ulist"><ul><li><p>Notice that <code>chart</code> and <code>version</code> are missing</p></li><li><p>They were not in the scope</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: moldy-jaguar-configmap
  labels:
    generator: helm
    date: 2016-11-02
    chart:
    version:</code></pre></div></div></div></section><section id="_passing_in_the_scope"><h2>Passing in the Scope</h2><div class="slide-content"><div class="ulist"><ul><li><p>We can pass in the current scope, this is how we ideally send parameters into a <code>define</code></p></li><li><p>Instead of the following which sends no parameters</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{ template "mychart.labels" }}</code></pre></div></div></li><li><p>We will include a dot (<code>.</code>) to represent the current scope</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{ template "mychart.labels" . }}</code></pre></div></div></li></ul></div></div></section><section id="_resulting_in_the_following"><h2>Resulting in the following</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
  {{- template "mychart.labels" .}}
data:
  myvalue: "Hello World"
  {{- range $key, $val := .Values.favorite }}
  {{ $key }}: {{ $val | quote }}
  {{- end }}</code></pre></div></div></div></section><section id="_include_function"><h2><code>include</code> function</h2><div class="slide-content"><div class="paragraph"><p>If provided the following:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{- define "mychart.app" -}}
app_name: {{ .Chart.Name }}
app_version: "{{ .Chart.Version }}+{{ .Release.Time.Seconds }}"
{{- end -}}</code></pre></div></div></div></section><section id="_calling_template"><h2>Calling <code>template</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Substituting it into template using <code>template</code></p></li><li><p>Notice the location of the <code>template</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
  labels:
    {{ template "mychart.app" .}}
data:
  myvalue: "Hello World"
  {{- range $key, $val := .Values.favorite }}
  {{ $key }}: {{ $val | quote }}
  {{- end }}
{{ template "mychart.app" . }}</code></pre></div></div></div></section><section id="_the_incorrect_output"><h2>The Incorrect Output</h2><div class="slide-content"><div class="ulist"><ul><li><p>Notice the location of <code>app_name</code> and <code>app_version</code> in both <code>labels</code> and <code>data</code></p></li><li><p><code>template</code> will organize in it&#8217;s own text alignment</p></li><li><p><code>template</code> is an <em>action</em>, not a function</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: measly-whippet-configmap
  labels:
    app_name: mychart
app_version: "0.1.0+1478129847"
data:
  myvalue: "Hello World"
  drink: "coffee"
  food: "pizza"
app_name: mychart
app_version: "0.1.0+1478129847"</code></pre></div></div></div></section><section id="_include_is_a_function"><h2><code>include</code> is a Function</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>include</code> is a function, instead of an action</p></li><li><p>Since it is a function, it is available to be chained to other functions</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
  labels:
    {{- include "mychart.app" . | nindent 4 }}
data:
  myvalue: "Hello World"
  {{- range $key, $val := .Values.favorite }}
  {{ $key }}: {{ $val | quote }}
  {{- end }}
  {{- include "mychart.app" . | nindent 2 }}</code></pre></div></div></div></section><section id="_what_it_renders_2"><h2>What it renders</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: edgy-mole-configmap
  labels:
    app_name: mychart
    app_version: "0.1.0+1478129987"
data:
  myvalue: "Hello World"
  drink: "coffee"
  food: "pizza"
  app_name: mychart
  app_version: "0.1.0+1478129987"</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Prefer <code>include</code> over <code>template</code></td></tr></table></div></div></section><section id="_accessing_files"><h2>Accessing Files</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can also bring in files into Helm</p></li><li><p>Files must be less than 1M</p></li><li><p>Files in <em>template/</em> directory cannot be accessed</p></li><li><p>Files excluded in <em>.helmignore</em> cannot be accessed</p></li></ul></div></div></section><section id="_creating_standard_files"><h2>Creating Standard Files</h2><div class="slide-content"><div class="listingblock"><div class="title">config1.txt</div><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-noescape="true" data-lang="text">message = "Hello from config 1"</code></pre></div></div>
<div class="listingblock"><div class="title">config2.txt:</div><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-noescape="true" data-lang="text">message = "This is config 2"</code></pre></div></div>
<div class="listingblock"><div class="title">config3.txt</div><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-noescape="true" data-lang="text">message = "Goodbye from config 3"</code></pre></div></div></div></section><section id="_using_range_to_include_the_files"><h2>Using <code>range</code> to include the Files</h2><div class="slide-content"><div class="paragraph"><p>Here, we will use a <code>range list</code> to get all the values in range and print them</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  {{- $files := .Files }}
  {{- range list "config1.txt" "config2.txt" "config3.txt" }}
  {{ . }}: |-
    {{ $files.Get . }}
  {{- end }}</code></pre></div></div></div></section><section id="_results_of_files_and_range"><h2>Results of <code>Files</code> and <code>range</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: quieting-giraf-configmap
data:
  config1.txt: |-
    message = "Hello from config 1"

  config2.txt: |-
    message = "This is config 2"

  config3.txt: |-
    message = "Goodbye from config 3"</code></pre></div></div></div></section><section id="_path_helpers" class="columns"><h2>Path Helpers</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="ulist"><ul><li><p>Helm imports many of the functions from Go&#8217;s <a href="https://golang.org/pkg/path/"><code>path</code></a></p></li><li><p>They use the same names, but instead of capital letters it uses small letters (e.g. <code>base</code> instead of <code>Base</code>)</p></li><li><p>Functions available at the <a href="http://masterminds.github.io/sprig/paths.html" target="_blank">Sprig Website</a></p></li></ul></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Common <code>File</code> Functions</p></div>
<div class="ulist"><ul><li><p><code>base</code> - Returns last element of the path <code>base "foo/bar/baz"</code> returns <code>baz</code></p></li><li><p><code>dir</code> - Return the directory, stripping the last part of the path. <code>foo/bar/baz</code> returns <code>foo/bar</code></p></li><li><p><code>ext</code> - Return the file extension. <code>ext "foo.bar"</code> returns <code>.bar</code></p></li><li><p><code>clean</code> - Clean up a path. <code>clean "foo/bar/../baz"</code> returns <code>foo/baz</code></p></li><li><p><code>isAbs</code> - Is the path absolute.</p></li></ul></div></div></div></div></section><section id="_glob_patterns"><h2>Glob Patterns</h2><div class="slide-content"><div class="ulist"><ul><li><p>Uses <code>Glob</code></p></li><li><p>Allows you to filter files in glob patterns</p></li><li><p>Returns a <code>Files</code> type, so you may call any of the <code>Files</code> methods on the returned object</p></li></ul></div></div></section><section id="_given_the_files"><h2>Given the files</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">foo/:
  foo.txt foo.yaml

bar/:
  bar.go bar.conf baz.yaml</code></pre></div></div></div></section><section id="_using_glob"><h2>Using <code>Glob</code>:</h2><div class="slide-content"><div class="ulist"><ul><li><p>Notice the <code>$path</code> and <code>$byte</code> are included with <code>Glob</code></p></li><li><p>We can enrich the content of <code>$path</code> and <code>$byte</code> with Go functions</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{ $root := . }} <i class="conum" data-value="1"></i><b>(1)</b>
{{ range $path, $bytes := .Files.Glob "foo/*" }}
{{ base $path }}: '{{ $root.Files.Get $path | b64enc }}' <i class="conum" data-value="2"></i><b>(2)</b>
{{ end }}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Assigning variable to <code>$root</code> so we may use in the <code>range</code> which has a different scope</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Encoding the contents into Base64</td></tr></table></div></li></ul></div></div></section><section id="_configmap_and_secrets_utility"><h2>Configmap and Secrets Utility</h2><div class="slide-content"><div class="ulist"><ul><li><p>Helps with configmaps and secrets</p></li><li><p>Helm Provides some utilities</p></li><li><p>Useful to use these methods in conjunction with the <code>Glob</code> method.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: conf
data:
  {{- (.Files.Glob "foo/*").AsConfig | nindent 2 }}
---
apiVersion: v1
kind: Secret
metadata:
  name: very-secret
type: Opaque
data:
  {{- (.Files.Glob "bar/*").AsSecrets | nindent 2 }}</code></pre></div></div></div></section><section id="_encoding"><h2>Encoding</h2><div class="slide-content"><div class="paragraph"><p>You can apply Base64 encoding using <code>b64enc</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-secret
type: Opaque
data:
  token: |-
    {{ .Files.Get "config1.toml" | b64enc }}</code></pre></div></div></div></section><section id="_lines"><h2>Lines</h2><div class="slide-content"><div class="paragraph"><p>To iterate each line in a template, you can use <code>.Files.Lines</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">data:
  some-file.txt: {{ range .Files.Lines "foo/bar.txt" }}
    {{ . }}{{ end }}</code></pre></div></div></div></section><section id="_notes_txt"><h2>NOTES.txt</h2><div class="slide-content"><div class="ulist"><ul><li><p>Provides help to end users</p></li><li><p>Is in plain text</p></li><li><p>Has template functions available, just like the other templates</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">Thank you for installing {{ .Chart.Name }}.

Your release is named {{ .Release.Name }}.

To learn more about the release, try:

  $ helm status {{ .Release.Name }}
  $ helm get {{ .Release.Name }}</code></pre></div></div></li></ul></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Remember <em>Notes.txt</em> is for after installation, <em>README</em> is for before installation</td></tr></table></div></div></section></section>
<section id="_lab_5_functions"><h2>Lab 5: Functions</h2><div class="slide-content"><div class="paragraph"><p>Open your lab book, <em>lab_book.html</em>, and do "Lab 5: Functions"</p></div></div></section>
<section><section id="_subcharts"><h2>Subcharts</h2><div class="slide-content"><div class="paragraph"><p>Agenda:</p></div><div class="ulist"><ul><li><p>Create a chart within a chart</p></li><li><p>Determine data for parents and children</p></li></ul></div></div></section><section id="_subcharts_definition"><h2>Subcharts Definition</h2><div class="slide-content"><div class="ulist"><ul><li><p>Charts can have dependencies called subcharts</p></li><li><p>They have their own values and templates</p></li></ul></div></div></section><section id="_subchart_details"><h2>Subchart Details</h2><div class="slide-content"><div class="ulist"><ul><li><p>Subcharts are considered "stand-alone"</p></li><li><p>Subchart can never</p><div class="ulist"><ul><li><p>Explicitly depend on its parent chart</p></li></ul></div></li><li><p>Parent Chart can override values of subchart</p></li><li><p>Helm has a concept of global values that can be accessed by all</p></li></ul></div></div></section><section id="_creating_a_subchart"><h2>Creating a subchart</h2><div class="slide-content"><div class="ulist"><ul><li><p>Change into a directory that is already a chart</p></li><li><p>Create a subchart in that directory using <code>helm create mysubchart</code></p></li><li><p>Clean out templates if you desire to define your own</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% cd mychart/charts
% helm create mysubchart
% rm -rf mysubchart/templates/*.*</code></pre></div></div></div></section><section id="_adding_values_and_template_to_subchart"><h2>Adding Values And Template to Subchart</h2><div class="slide-content"><div class="paragraph"><p>In the <code>subchart</code>, there is a <em>Values.yaml</em> file where we can include:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">dessert: cake</code></pre></div></div></div></section><section id="_using_values_from_subcharts_own_values_yaml"><h2>Using <code>Values</code> from Subchart&#8217;s own <code>values.yaml</code></h2><div class="slide-content"><div class="paragraph"><p>We can then create a ConfigMap template in <em>mychart/charts/mysubchart/templates/configmap.yaml</em></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-cfgmap2
data:
  dessert: {{ .Values.dessert }}</code></pre></div></div></div></section><section id="_what_it_renders_3"><h2>What it renders</h2><div class="slide-content"><div class="paragraph"><p>Because the charts works as is, it becomes the following:</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mysubchart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: newbie-elk-cfgmap2
data:
  dessert: cake</code></pre></div></div></div></section><section id="_overriding_the_defaults"><h2>Overriding the defaults</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>mychart</code> is now the parent of <code>mysubchart</code></p></li><li><p>Since this relationship exists, we can specify configuration at <code>mychart</code> and pushed to <code>mysubchart</code></p></li><li><p>In other words <em>mychart/values.yaml</em></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">favorite:
  drink: coffee
  food: pizza
pizzaToppings:
  - mushrooms
  - cheese
  - peppers
  - onions

mysubchart:
  dessert: ice cream</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">The last two lines will have information for the subchart</td></tr></table></div></div></section><section id="_rendering_the_results"><h2>Rendering the Results</h2><div class="slide-content"><div class="ulist"><ul><li><p>Remember that our favorite dessert was <code>cake</code></p></li><li><p>The parent now has an override defined in <code>configmap.yaml</code></p></li><li><p>The following shows the results of the ConfigMap defined in <code>mysubchart</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/charts/mysubchart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: unhinged-bee-cfgmap2
data:
  dessert: ice cream</code></pre></div></div></div></section><section id="_global_chart_values"><h2>Global Chart Values</h2><div class="slide-content"><div class="ulist"><ul><li><p>Global values are values that can be accessed from any chart or subchart by exactly the same name</p></li><li><p>Globals require explicit declaration</p></li><li><p>You can’t use an existing non-global as if it were a global</p></li></ul></div></div></section><section id="_creating_a_global_section_in_values"><h2>Creating a Global Section in Values</h2><div class="slide-content"><div class="ulist"><ul><li><p>Both of the following should be able to access the value <code>global.salad</code> as <code>{{ .Values.global.salad}}</code>.</p><div class="ulist"><ul><li><p><em>mychart/templates/configmap.yaml</em></p></li><li><p><em>mychart/charts/mysubchart/templates/configmap.yaml</em></p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">favorite:
  drink: coffee
  food: pizza
pizzaToppings:
  - mushrooms
  - cheese
  - peppers
  - onions

mysubchart:
  dessert: ice cream

global:
  salad: caesar</code></pre></div></div></div></section><section id="_configuring_parent_charts_config_map"><h2>Configuring Parent Chart&#8217;s Config Map</h2><div class="slide-content"><div class="paragraph"><p>In <em>mychart/templates/configmap.yaml</em>, notice the <code>salad</code> value</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  salad: {{ .Values.global.salad }}</code></pre></div></div></div></section><section id="_configuring_subcharts_config_map"><h2>Configuring Subcharts' Config Map</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-cfgmap2
data:
  dessert: {{ .Values.dessert }}
  salad: {{ .Values.global.salad }}</code></pre></div></div></div></section><section id="_the_parent_charts_result"><h2>The Parent Chart&#8217;s Result</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml"># Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: silly-snake-configmap
data:
  salad: caesar</code></pre></div></div></div></section><section id="_the_child_charts_result"><h2>The Child Chart&#8217;s Result</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: silly-snake-cfgmap2
data:
  dessert: ice cream
  salad: caesar</code></pre></div></div></div></section><section id="_sharing_templates_with_subcharts"><h2>Sharing Templates with Subcharts</h2><div class="slide-content"><div class="ulist"><ul><li><p>All templates to include are stored by unique name</p></li><li><p>Therefore they are possible to include in any chart or subchart</p></li><li><p>Be sure to favor <code>include</code> over <code>template</code></p></li></ul></div></div></section></section>
<section id="_lab_6_subcharts"><h2>Lab 6: Subcharts</h2><div class="slide-content"><div class="paragraph"><p>Open your lab book, <em>lab_book.html</em>, and do "Lab 6: Subcharts"</p></div></div></section>
<section><section id="_plugins"><h2>Plugins</h2><div class="slide-content"><div class="ulist"><ul><li><p>A plugin is a tool that can be accessed through the helm CLI</p></li><li><p>Not part of the built-in Helm</p></li><li><p>Wide array of a <a href="https://v2.helm.sh/docs/related/#helm-plugins">list of plugins</a></p></li><li><p>Also available at <a href="https://github.com/search?q=topic%3Ahelm-plugin&amp;type=Repositories">Github</a></p></li></ul></div></div></section><section id="_plugin_overview"><h2>Plugin Overview</h2><div class="slide-content"><div class="ulist"><ul><li><p>Integrate with Helm CLI</p></li><li><p>Provide a way to extend the core of Helm</p></li><li><p>Without requiring every new feature to be written in Go</p></li></ul></div></div></section><section id="_plugin_features"><h2>Plugin Features</h2><div class="slide-content"><div class="ulist"><ul><li><p>Can be added and removed from a Helm installation without impacting the core Helm tool</p></li><li><p>Written in any programming language</p></li><li><p>Will show up with <code>helm help</code></p></li></ul></div></div></section><section id="_installing_a_plugin"><h2>Installing a Plugin</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can pass in a path to a plugin, either</p><div class="ulist"><ul><li><p>Local file system</p></li><li><p>Url of a remote VCS repo</p></li></ul></div></li><li><p>Plugins get cloned in <code>$(helm home)/plugins</code></p></li><li><p>Use <code>helm env</code> to determine where helm&#8217;s home directory is located</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm plugin install &lt;path|url&gt;</code></pre></div></div></div></section><section id="_installing_via_tarball"><h2>Installing via Tarball</h2><div class="slide-content"><div class="ulist"><ul><li><p>If you have a plugin tar distribution, simply untar the plugin into the <code>$(helm home)/plugins</code> directory, or whatever plugin directory as directed by <code>helm env</code></p></li><li><p>You can also install tarball plugins directly from url by issuing helm plugin install <a href="http://domain/path/to/plugin.tar.gz" class="bare">http://domain/path/to/plugin.tar.gz</a></p></li></ul></div></div></section><section id="_example_plugin_s3"><h2>Example Plugin: S3</h2><div class="slide-content"><div class="ulist"><ul><li><p>An Example Plugin is the S3 Plugin[<a href="https://github.com/hypnoglow/helm-s3" class="bare">https://github.com/hypnoglow/helm-s3</a>]</p></li><li><p>It can use AWS S3 as a chart repository</p></li></ul></div></div></section><section id="_creating_the_aws_bucket"><h2>Creating the AWS Bucket</h2><div class="slide-content"><div class="imageblock"><img src="./images/Create-bucket.png" alt="Create bucket"></div></div></section><section id="_installing_the_s3_plugin"><h2>Installing the S3 Plugin</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm plugin install https://github.com/hypnoglow/helm-s3.git</code></pre></div></div></div></section><section id="_initializing_the_s3_plugin"><h2>Initializing the S3 Plugin</h2><div class="slide-content"><div class="ulist"><ul><li><p>We initialize the plugin using <code>S3 init</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm S3 init s3://my-helm-charts/charts</code></pre></div></div>
<div class="ulist"><ul><li><p>After we can then introduce the URL as a repository</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm repo add my-charts s3://my-helm-charts/charts</code></pre></div></div></div></section><section id="_display_all_the_repos"><h2>Display all the repos</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm repo list
NAME            URL
stable          https://kubernetes-charts.storage.googleapis.com
local           http://127.0.0.1:8879/charts
my-charts       s3://my-helm-charts/charts</code></pre></div></div></div></section><section id="_creating_a_simple_helm_chart"><h2>Creating a Simple Helm Chart</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm create test-chart
Creating test-chart
# Remove the initial cruft
$ rm -rf test-chart/templates/*.*
# Create a ConfigMap template at test-chart/templates/configmap.yaml
$ cat > test-chart/templates/configmap.yaml &lt;&lt; EOL
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-chart-configmap
data:
  myvalue: "Hello World"
EOL</code></pre></div></div></div></section><section id="_install_the_chart"><h2>Install the Chart</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm install ./test-chart
NAME:   zeroed-armadillo
LAST DEPLOYED: Fri Feb  9 17:10:38 2018
NAMESPACE: default
STATUS: DEPLOYED

RESOURCES:
==&gt; v1/ConfigMap
NAME               DATA  AGE
test-chart-configmap  1     0s</code></pre></div></div></div></section><section id="_remove_it_again"><h2>Remove it again</h2><div class="slide-content"><div class="ulist"><ul><li><p>Since we wanted to ensure that it works</p></li><li><p>We can remove it from the K8S cluster</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh"># --purge removes the release from the "store" completely
% helm uninstall --purge zeroed-armadillo
release "zeroed-armadillo" deleted</code></pre></div></div></div></section><section id="_upload_the_test_chart"><h2>Upload the test chart</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm package ./test-chart
Successfully packaged chart and saved it to: ~/test-chart-0.1.0.tgz</code></pre></div></div></div></section><section id="_once_complete_send_it_to_s3"><h2>Once complete, send it to S3</h2><div class="slide-content"><div class="ulist"><ul><li><p>Specify the <code>tgz</code> file</p></li><li><p>Specify the name of the repository</p></li><li><p>Ensure that you version with SemVer2</p></li><li><p>Ensure that you treat each release as immutable</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm s3 push ./test-chart-0.1.0.tgz my-charts</code></pre></div></div></div></section></section>
<section><section id="_testing_helm"><h2>Testing Helm</h2></section><section id="_unit_testing_helm"><h2>Unit Testing Helm</h2><div class="slide-content"><div class="paragraph"><p><a href="https://github.com/quintush/helm-unittest" class="bare">https://github.com/quintush/helm-unittest</a></p></div>
<div class="ulist"><ul><li><p>Write test file in pure YAML</p></li><li><p>Render locally with no need of tiller</p></li><li><p>Create nothing on your cluster</p></li><li><p>Define values and release options</p></li><li><p>Snapshot testing</p></li></ul></div></div></section><section id="_install_as_plugin"><h2>Install as Plugin</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm plugin install https://github.com/quintush/helm-unittest</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content"><code>quintush/helm-unittest</code> is the latest plugin that works with Helm Version 3</td></tr></table></div></div></section><section id="_building_a_test"><h2>Building a Test</h2><div class="slide-content"><div class="ulist"><ul><li><p>Create a <code>tests</code> folder</p></li><li><p>Add <code>tests</code> directory to your chart</p></li><li><p>Add file, for example, to <em>$YOUR_CHART/tests/deployment_test.yaml</em></p></li></ul></div></div></section><section id="_example_test"><h2>Example Test</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">suite: test deployment
templates:
  - deployment.yaml
tests:
  - it: should work
    set:
      image.tag: latest
    asserts:
      - isKind:
          of: Deployment
      - matchRegex:
          path: metadata.name
          pattern: -my-chart$
      - equal:
          path: spec.template.spec.containers[0].image
          value: nginx:latest</code></pre></div></div></div></section><section id="_running_the_test"><h2>Running the Test</h2><div class="slide-content"><div class="paragraph"><p>To run the tests</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm unittest $YOUR_CHART</code></pre></div></div>
<div class="paragraph"><p>If you wish to use a different folder, you can use <code>-f</code>, or <code>--file</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm unittest -f 'my-tests/*.yaml' -f 'more-tests/*.yaml' my-chart</code></pre></div></div></div></section><section id="_snapshot_testing"><h2>Snapshot Testing</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can take a snapshot of the entire manifest or portions with a snapshot</p></li><li><p>This avoids the need assert every single element</p></li><li><p>This will match an element against the snapshot taken the previous time</p></li><li><p>Snapshots are located in the <code><em>snapshot</em>/*<em>test.yaml.snap</em></code> directory</p></li><li><p>Run <code>-u</code> or <code>--update-snapshot</code> to update the snapshot</p></li></ul></div></div></section><section id="_snapshot_example_test"><h2>Snapshot Example Test</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">templates:
  - deployment.yaml
tests:
  - it: pod spec should match snapshot
    asserts:
      - matchSnapshot:
          path: spec.template.spec
  # or you can snapshot the whole manifest
  - it: manifest should match snapshot
    asserts:
      - matchSnapshot: {}</code></pre></div></div></div></section><section id="_test_suite_detail"><h2>Test Suite Detail</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">suite: test deploy and service
templates:
  - deployment.yaml
  - service.yaml
tests:
  - it: should test something
    ...</code></pre></div></div>
<div class="ulist"><ul><li><p><code>suite</code>: <em>string, optional</em>. The suite name to show on test result output.</p></li><li><p><code>templates</code>: <em>array of string, recommended</em>. The template files scope to test in this suite, only the ones specified here is rendered during testing. If omitted, all template files are rendered. File suffixed with .tpl is added automatically, you don&#8217;t need to add them again.</p></li><li><p><code>tests</code>: <em>array of test job, required</em>. Where you define your test jobs to run, check Test Job.</p></li></ul></div></div></section><section id="_test_job"><h2>Test Job</h2><div class="slide-content"><div class="ulist"><ul><li><p>The test job is the base unit of testing</p></li><li><p>Your chart is rendered each time a test job run, and validated with assertions defined in the test</p></li><li><p>You can setup your values used to render the chart in the test job with external values files or directly in the test job definition</p></li></ul></div></div></section><section id="_test_details"><h2>Test Details</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">tests:
  - it: should pass
    values:
      - ./values/staging.yaml
    set:
      image.pullPolicy: Always
      resources:
        limits:
          memory: 128Mi
    release:
      name: my-release
      namespace:
      revision: 9
      isUpgrade: true
    asserts:
      - equal:
          path: metadata.name
          value: my-deploy</code></pre></div></div>
<div class="ulist"><ul><li><p><code>it</code> - Define the name of the test with TDD style or any message you like.</p></li><li><p><code>values</code> - The values files used to renders the chart, like <em>Values.yaml</em></p></li><li><p><code>set</code> - Set the values directly in suite file, analogous to <code>--set</code></p></li></ul></div></div></section><section id="_various_assertions"><h2>Various Assertions</h2><div class="slide-content"><div class="ulist"><ul><li><p>Equality: <code>equal</code>, <code>notEqual</code></p></li><li><p>Regex: <code>matchRegex</code>, <code>notRegexMatch</code></p></li><li><p>Contains: <code>contains</code>, <code>notContains</code></p></li><li><p>Null: <code>isNull</code>, <code>isNotNull</code></p></li><li><p>Empty: <code>isEmpty</code>, <code>isNotEmpty</code></p></li><li><p>APIVersion: <code>apiVersion</code> of Manifest</p></li><li><p>Number of Documents: <code>hasDocuments</code> Expected number of documents rendered</p></li><li><p>Match Snapshot: Path that should not change from one run to another</p></li></ul></div></div></section><section id="_integration_testing"><h2>Integration Testing</h2><div class="slide-content"><div class="ulist"><ul><li><p>A test in a helm chart lives under the <code>templates/tests</code> directory</p></li><li><p>These are different than a unit test</p></li><li><p>A job or pod definition that specifies a container with a given command to run.</p></li><li><p>Container should run successfully</p></li><li><p>Must have annotation: <code>helm.sh/hook: test</code></p></li></ul></div></div></section><section id="_example_tests"><h2>Example Tests</h2><div class="slide-content"><div class="ulist"><ul><li><p>Validate that your configuration from the <em>values.yaml</em> file was properly injected.</p></li><li><p>Make sure your username and password work correctly</p></li><li><p>Make sure an incorrect username and password does not work</p></li><li><p>Assert that your services are up and correctly load balancing</p></li></ul></div></div></section><section id="_maria_db_example_helm_test"><h2>Maria DB Example Helm Test</h2><div class="slide-content"><div class="ulist"><ul><li><p>The following is an example of Maria DB&#8217;s integration test</p></li><li><p>Note the <code>command</code> used when running this pod</p><div class="ulist"><ul><li><p>This connects to the database used credentials from <em>values.yaml</em> and password from a deployed secret</p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-noescape="true" data-lang="yaml">{{- if .Values.mariadb.enabled }}
apiVersion: v1
kind: Pod
metadata:
  name: "{{ .Release.Name }}-credentials-test"
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
    - name: {{ .Release.Name }}-credentials-test
      image: {{ template "wordpress.image" . }}
      imagePullPolicy: {{ .Values.image.pullPolicy | quote }}
      {{- if .Values.securityContext.enabled }}
      securityContext:
        runAsUser: {{ .Values.securityContext.runAsUser }}
      {{- end }}
      env:
        - name: MARIADB_HOST
          value: {{ template "mariadb.fullname" . }}
        - name: MARIADB_PORT
          value: "3306"
        - name: WORDPRESS_DATABASE_NAME
          value: {{ default "" .Values.mariadb.db.name | quote }}
        - name: WORDPRESS_DATABASE_USER
          value: {{ default "" .Values.mariadb.db.user | quote }}
        - name: WORDPRESS_DATABASE_PASSWORD
          valueFrom:
            secretKeyRef:
              name: {{ template "mariadb.fullname" . }}
              key: mariadb-password
      command:
        - /bin/bash
        - -ec
        - |
          mysql --host=$MARIADB_HOST --port=$MARIADB_PORT --user=$WORDPRESS_DATABASE_USER --password=$WORDPRESS_DATABASE_PASSWORD
  restartPolicy: Never
{{- end }}</code></pre></div></div></div></section><section id="_run_an_integration_test_on_the_command_line"><h2>Run an Integration Test on the Command Line</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sh hljs" data-noescape="true" data-lang="sh">% helm test [RELEASE] [flags]</code></pre></div></div></div></section></section>
<section id="_lab_7_testing"><h2>Lab 7: Testing</h2><div class="slide-content"><div class="paragraph"><p>Open your lab book, <em>lab_book.html</em>, and do "Lab 7: Testing"</p></div></div></section>
<section><section id="_commands"><h2>Commands</h2><div class="slide-content"><div class="ulist"><ul><li><p>Commands in Helm</p></li><li><p>For a Complete List visit <a href="https://v2.helm.sh/docs/helm/">the website for details</a></p></li></ul></div></div></section><section id="_helm_completion"><h2><code>helm completion</code></h2><div class="slide-content"><div class="paragraph"><p>Generate autocompletions script for the specified shell (bash or zsh)</p></div></div></section><section id="_helm_list"><h2><code>helm list</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>This command lists all of the releases.</p></li><li><p>By default, it lists only releases that are deployed or failed. Flags like <code>–deleted</code> and <code>–all</code> will alter this behavior. Such flags can be combined: <code>–deleted –failed</code>.</p></li><li><p>By default, items are sorted alphabetically. Use the <code>-d</code> flag to sort by release date.</p></li><li><p>If an argument is provided, it will be treated as a filter. Filters are regular expressions (Perl compatible) that are applied to the list of releases. Only items that match the filter will be returned.</p></li></ul></div></div></section><section id="_helm_package"><h2><code>helm package</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Package a chart directory into a chart archive</p></li><li><p>This command packages a chart into a versioned chart archive file.</p></li><li><p>If a path is given, this will look at that path for a chart (which must contain a Chart.yaml file) and then package that directory.</p></li></ul></div></div></section><section id="_helm_plugin"><h2><code>helm plugin</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Manage helm plugins, including:</p><div class="ulist"><ul><li><p><code>helm plugin install</code> - Install one or more Helm plugins</p></li><li><p><code>helm plugin list</code> - List installed Helm plugins</p></li><li><p><code>helm plugin remove</code> - Remove one or more Helm plugins</p></li><li><p><code>helm plugin update</code> - Update one or more Helm plugins</p></li></ul></div></li></ul></div></div></section><section id="_helm_repo"><h2><code>helm repo</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Manage repositories to pull charts and plugins</p><div class="ulist"><ul><li><p><code>helm repo add</code> - Add a chart repository</p></li><li><p><code>helm repo index</code> - Generate an index file given a directory containing packaged charts</p></li><li><p><code>helm repo list</code> - List chart repositories</p></li><li><p><code>helm repo remove</code> - Remove a chart repository</p></li><li><p><code>helm repo update</code> - Update information of available charts locally from chart repositories</p></li></ul></div></li></ul></div></div></section><section id="_helm_upgrade"><h2><code>helm upgrade</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Upgrades a release to a specified version of a chart and/or updates chart values.</p></li><li><p>You can use <code>--set</code> for ad-hoc changes</p></li><li><p>Include the release name: <code>helm upgrade [RELEASE] [CHART] [flags]</code></p></li><li><p>All upgrades are available to rollback</p></li></ul></div></div></section><section id="_helm_rollback"><h2><code>helm rollback</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Rolls back a release to a previous revision.</p></li><li><p>The first argument of the rollback command is the name of a release</p></li><li><p>Second is a revision (version) number.</p></li><li><p>To see revision numbers, run ‘helm history RELEASE’</p></li><li><p>If you’d like to rollback to the previous release use ‘helm rollback [RELEASE] 0’.</p></li></ul></div></div></section><section id="_helm_version"><h2><code>helm version</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>Display the version</p></li></ul></div></div></section></section>
<section id="_lab_8_deploy"><h2>Lab 8: Deploy</h2><div class="slide-content"><div class="paragraph"><p>Open your lab book, <em>lab_book.html</em>, and do "Lab 8: Deploying"</p></div></div></section>
<section><section id="_what_is_new_in_helm_v3"><h2>What is new in Helm V3?</h2></section><section id="_client_only_architecture"><h2>Client-Only Architecture</h2><div class="slide-content"><div class="ulist"><ul><li><p>Helm 3 doesn&#8217;t require Tiller on K8s, unlike Helm 2</p></li><li><p>The main benefit of removing Tiller is that security is now on a per-user basis</p></li></ul></div>
<div class="imageblock"><img src="./images/helm3-arch.png" alt="helm3 arch" width="50%" height="50%"></div></div></section><section id="_xdg_base_directory_specification"><h2>XDG base directory specification</h2><div class="slide-content"><div class="ulist"><ul><li><p>Helm 3 doesn&#8217;t use <code>.helm</code> directory</p></li><li><p>Uses XDG Standard, Platform Independent, Directories</p></li><li><p>XDG Standards: <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html" class="bare">https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html</a></p></li></ul></div></div></section><section id="_no_need_to_helm_init"><h2>No need to <code>helm init</code></h2><div class="slide-content"><div class="ulist"><ul><li><p><code>helm init</code> is removed, no need to install</p></li><li><p>Helm state is created when required</p></li></ul></div></div></section><section id="_more_specifics"><h2>More specifics</h2><div class="slide-content"><div class="paragraph"><p>Source: <a href="https://developer.ibm.com/technologies/containers/blogs/kubernetes-helm-3/" class="bare">https://developer.ibm.com/technologies/containers/blogs/kubernetes-helm-3/</a></p></div></div></section></section>
<section id="_where_to_get_more_information"><h2>Where to get more information</h2><div class="slide-content"><div class="paragraph"><p><a href="https://helm.sh/blog/2019-10-22-helm-2150-released" class="bare">https://helm.sh/blog/2019-10-22-helm-2150-released</a></p></div></div></section></div></div><script src="node_modules/reveal.js/dist/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: false,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: true,
  // Push each slide change to the browser history. Implies `hash: true`
  history: false,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'node_modules/reveal.js/plugin/zoom/zoom.js', async: true, callback: function () { Reveal.registerPlugin(RevealZoom) } },
      { src: 'node_modules/reveal.js/plugin/notes/notes.js', async: true, callback: function () { Reveal.registerPlugin(RevealNotes) } }
  ],
});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(960, 700)
});</script><link rel="stylesheet" href="color-brewer.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/shell.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/go.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/hcl.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/languages/yaml.min.js"></script>

<script>

/* highlightjs-line-numbers.js 2.6.0 | (C) 2018 Yauheni Pakala | MIT License | github.com/wcoder/highlightjs-line-numbers.js */
/* Edited by Hakim for reveal.js; removed async timeout */
!function(n,e){"use strict";function t(){var n=e.createElement("style");n.type="text/css",n.innerHTML=g(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,L,b]),e.getElementsByTagName("head")[0].appendChild(n)}function r(t){"interactive"===e.readyState||"complete"===e.readyState?i(t):n.addEventListener("DOMContentLoaded",function(){i(t)})}function i(t){try{var r=e.querySelectorAll("code.hljs,code.nohighlight");for(var i in r)r.hasOwnProperty(i)&&l(r[i],t)}catch(o){n.console.error("LineNumbers error: ",o)}}function l(n,e){"object"==typeof n&&f(function(){n.innerHTML=s(n,e)})}function o(n,e){if("string"==typeof n){var t=document.createElement("code");return t.innerHTML=n,s(t,e)}}function s(n,e){e=e||{singleLine:!1};var t=e.singleLine?0:1;return c(n),a(n.innerHTML,t)}function a(n,e){var t=u(n);if(""===t[t.length-1].trim()&&t.pop(),t.length>e){for(var r="",i=0,l=t.length;i<l;i++)r+=g('<tr><td class="{0}"><div class="{1} {2}" {3}="{5}"></div></td><td class="{4}"><div class="{1}">{6}</div></td></tr>',[j,m,L,b,p,i+1,t[i].length>0?t[i]:" "]);return g('<table class="{0}">{1}</table>',[v,r])}return n}function c(n){var e=n.childNodes;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];h(r.textContent)>0&&(r.childNodes.length>0?c(r):d(r.parentNode))}}function d(n){var e=n.className;if(/hljs-/.test(e)){for(var t=u(n.innerHTML),r=0,i="";r<t.length;r++){var l=t[r].length>0?t[r]:" ";i+=g('<span class="{0}">{1}</span>\n',[e,l])}n.innerHTML=i.trim()}}function u(n){return 0===n.length?[]:n.split(y)}function h(n){return(n.trim().match(y)||[]).length}function f(e){e()}function g(n,e){return n.replace(/{(\d+)}/g,function(n,t){return e[t]?e[t]:n})}var v="hljs-ln",m="hljs-ln-line",p="hljs-ln-code",j="hljs-ln-numbers",L="hljs-ln-n",b="data-line-number",y=/\r\n|\r|\n/g;n.hljs?(n.hljs.initLineNumbersOnLoad=r,n.hljs.lineNumbersBlock=l,n.hljs.lineNumbersValue=o,t()):n.console.error("highlight.js not detected!")}(window,document);

/**
 * This reveal.js plugin is wrapper around the highlight.js
 * syntax highlighting library.
 */
(function( root, factory ) {
  if (typeof define === 'function' && define.amd) {
    root.RevealHighlight = factory();
  } else if( typeof exports === 'object' ) {
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.RevealHighlight = factory();
  }
}( this, function() {

  // Function to perform a better "data-trim" on code snippets
  // Will slice an indentation amount on each line of the snippet (amount based on the line having the lowest indentation length)
  function betterTrim(snippetEl) {
    // Helper functions
    function trimLeft(val) {
      // Adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill
      return val.replace(/^[\s\uFEFF\xA0]+/g, '');
    }
    function trimLineBreaks(input) {
      var lines = input.split('\n');

      // Trim line-breaks from the beginning
      for (var i = 0; i < lines.length; i++) {
        if (lines[i].trim() === '') {
          lines.splice(i--, 1);
        } else break;
      }

      // Trim line-breaks from the end
      for (var i = lines.length-1; i >= 0; i--) {
        if (lines[i].trim() === '') {
          lines.splice(i, 1);
        } else break;
      }

      return lines.join('\n');
    }

    // Main function for betterTrim()
    return (function(snippetEl) {
      var content = trimLineBreaks(snippetEl.innerHTML);
      var lines = content.split('\n');
      // Calculate the minimum amount to remove on each line start of the snippet (can be 0)
      var pad = lines.reduce(function(acc, line) {
        if (line.length > 0 && trimLeft(line).length > 0 && acc > line.length - trimLeft(line).length) {
          return line.length - trimLeft(line).length;
        }
        return acc;
      }, Number.POSITIVE_INFINITY);
      // Slice each line with this amount
      return lines.map(function(line, index) {
        return line.slice(pad);
      })
        .join('\n');
    })(snippetEl);
  }

  var RevealHighlight = {

    HIGHLIGHT_STEP_DELIMITER: '|',
    HIGHLIGHT_LINE_DELIMITER: ',',
    HIGHLIGHT_LINE_RANGE_DELIMITER: '-',

    init: function( reveal ) {

      // Read the plugin config options and provide fallbacks
      var config = Reveal.getConfig().highlight || {};
      config.highlightOnLoad = typeof config.highlightOnLoad === 'boolean' ? config.highlightOnLoad : true;
      config.escapeHTML = typeof config.escapeHTML === 'boolean' ? config.escapeHTML : true;

      [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code' ) ).forEach( function( block ) {

        block.parentNode.className = 'code-wrapper';

        // Code can optionally be wrapped in script template to avoid
        // HTML being parsed by the browser (i.e. when you need to
        // include <, > or & in your code).
        let substitute = block.querySelector( 'script[type="text/template"]' );
        if( substitute ) {
          // textContent handles the HTML entity escapes for us
          block.textContent = substitute.innerHTML;
        }

        // Trim whitespace if the "data-trim" attribute is present
        if( block.hasAttribute( 'data-trim' ) && typeof block.innerHTML.trim === 'function' ) {
          block.innerHTML = betterTrim( block );
        }

        // Escape HTML tags unless the "data-noescape" attrbute is present
        if( config.escapeHTML && !block.hasAttribute( 'data-noescape' )) {
          block.innerHTML = block.innerHTML.replace( /</g,"&lt;").replace(/>/g, '&gt;' );
        }

        // Re-highlight when focus is lost (for contenteditable code)
        block.addEventListener( 'focusout', function( event ) {
          hljs.highlightElement( event.currentTarget );
        }, false );

        if( config.highlightOnLoad ) {
          RevealHighlight.highlightBlock( block );
        }
      } );

      // If we're printing to PDF, scroll the code highlights of
      // all blocks in the deck into view at once
      reveal.on( 'pdf-ready', function() {
        [].slice.call( reveal.getRevealElement().querySelectorAll( 'pre code[data-line-numbers].current-fragment' ) ).forEach( function( block ) {
          RevealHighlight.scrollHighlightedLineIntoView( block, {}, true );
        } );
      } );
    },

    /**
     * Highlights a code block. If the <code> node has the
     * 'data-line-numbers' attribute we also generate slide
     * numbers.
     *
     * If the block contains multiple line highlight steps,
     * we clone the block and create a fragment for each step.
     */
    highlightBlock: function( block ) {

      hljs.highlightElement( block );

      // Don't generate line numbers for empty code blocks
      if( block.innerHTML.trim().length === 0 ) return;

      if( block.hasAttribute( 'data-line-numbers' ) ) {
        hljs.lineNumbersBlock( block, { singleLine: true } );

        var scrollState = { currentBlock: block };

        // If there is at least one highlight step, generate
        // fragments
        var highlightSteps = RevealHighlight.deserializeHighlightSteps( block.getAttribute( 'data-line-numbers' ) );
        if( highlightSteps.length > 1 ) {

          // If the original code block has a fragment-index,
          // each clone should follow in an incremental sequence
          var fragmentIndex = parseInt( block.getAttribute( 'data-fragment-index' ), 10 );

          if( typeof fragmentIndex !== 'number' || isNaN( fragmentIndex ) ) {
            fragmentIndex = null;
          }

          // Generate fragments for all steps except the original block
          highlightSteps.slice(1).forEach( function( highlight ) {

            var fragmentBlock = block.cloneNode( true );
            fragmentBlock.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlight ] ) );
            fragmentBlock.classList.add( 'fragment' );
            block.parentNode.appendChild( fragmentBlock );
            RevealHighlight.highlightLines( fragmentBlock );

            if( typeof fragmentIndex === 'number' ) {
              fragmentBlock.setAttribute( 'data-fragment-index', fragmentIndex );
              fragmentIndex += 1;
            }
            else {
              fragmentBlock.removeAttribute( 'data-fragment-index' );
            }

            // Scroll highlights into view as we step through them
            fragmentBlock.addEventListener( 'visible', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock, scrollState ) );
            fragmentBlock.addEventListener( 'hidden', RevealHighlight.scrollHighlightedLineIntoView.bind( Plugin, fragmentBlock.previousSibling, scrollState ) );

          } );

          block.removeAttribute( 'data-fragment-index' )
          block.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlightSteps[0] ] ) );

        }

        // Scroll the first highlight into view when the slide
        // becomes visible. Note supported in IE11 since it lacks
        // support for Element.closest.
        var slide = typeof block.closest === 'function' ? block.closest( 'section:not(.stack)' ) : null;
        if( slide ) {
          var scrollFirstHighlightIntoView = function() {
            RevealHighlight.scrollHighlightedLineIntoView( block, scrollState, true );
            slide.removeEventListener( 'visible', scrollFirstHighlightIntoView );
          }
          slide.addEventListener( 'visible', scrollFirstHighlightIntoView );
        }

        RevealHighlight.highlightLines( block );

      }

    },

    /**
     * Animates scrolling to the first highlighted line
     * in the given code block.
     */
    scrollHighlightedLineIntoView: function( block, scrollState, skipAnimation ) {

      cancelAnimationFrame( scrollState.animationFrameID );

      // Match the scroll position of the currently visible
      // code block
      if( scrollState.currentBlock ) {
        block.scrollTop = scrollState.currentBlock.scrollTop;
      }

      // Remember the current code block so that we can match
      // its scroll position when showing/hiding fragments
      scrollState.currentBlock = block;

      var highlightBounds = RevealHighlight.getHighlightedLineBounds( block )
      var viewportHeight = block.offsetHeight;

      // Subtract padding from the viewport height
      var blockStyles = getComputedStyle( block );
      viewportHeight -= parseInt( blockStyles.paddingTop ) + parseInt( blockStyles.paddingBottom );

      // Scroll position which centers all highlights
      var startTop = block.scrollTop;
      var targetTop = highlightBounds.top + ( Math.min( highlightBounds.bottom - highlightBounds.top, viewportHeight ) - viewportHeight ) / 2;

      // Account for offsets in position applied to the
      // <table> that holds our lines of code
      var lineTable = block.querySelector( '.hljs-ln' );
      if( lineTable ) targetTop += lineTable.offsetTop - parseInt( blockStyles.paddingTop );

      // Make sure the scroll target is within bounds
      targetTop = Math.max( Math.min( targetTop, block.scrollHeight - viewportHeight ), 0 );

      if( skipAnimation === true || startTop === targetTop ) {
        block.scrollTop = targetTop;
      }
      else {

        // Don't attempt to scroll if there is no overflow
        if( block.scrollHeight <= viewportHeight ) return;

        var time = 0;
        var animate = function() {
          time = Math.min( time + 0.02, 1 );

          // Update our eased scroll position
          block.scrollTop = startTop + ( targetTop - startTop ) * RevealHighlight.easeInOutQuart( time );

          // Keep animating unless we've reached the end
          if( time < 1 ) {
            scrollState.animationFrameID = requestAnimationFrame( animate );
          }
        };

        animate();

      }

    },

    /**
     * The easing function used when scrolling.
     */
    easeInOutQuart: function( t ) {

      // easeInOutQuart
      return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t;

    },

    getHighlightedLineBounds: function( block ) {

      var highlightedLines = block.querySelectorAll( '.highlight-line' );
      if( highlightedLines.length === 0 ) {
        return { top: 0, bottom: 0 };
      }
      else {
        var firstHighlight = highlightedLines[0];
        var lastHighlight = highlightedLines[ highlightedLines.length -1 ];

        return {
          top: firstHighlight.offsetTop,
          bottom: lastHighlight.offsetTop + lastHighlight.offsetHeight
        }
      }

    },

    /**
     * Visually emphasize specific lines within a code block.
     * This only works on blocks with line numbering turned on.
     *
     * @param {HTMLElement} block a <code> block
     * @param {String} [linesToHighlight] The lines that should be
     * highlighted in this format:
     * "1" 		= highlights line 1
     * "2,5"	= highlights lines 2 & 5
     * "2,5-7"	= highlights lines 2, 5, 6 & 7
     */
    highlightLines: function( block, linesToHighlight ) {

      var highlightSteps = RevealHighlight.deserializeHighlightSteps( linesToHighlight || block.getAttribute( 'data-line-numbers' ) );

      if( highlightSteps.length ) {

        highlightSteps[0].forEach( function( highlight ) {

          var elementsToHighlight = [];

          // Highlight a range
          if( typeof highlight.end === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child(n+'+highlight.start+'):nth-child(-n+'+highlight.end+')' ) );
          }
          // Highlight a single line
          else if( typeof highlight.start === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child('+highlight.start+')' ) );
          }

          if( elementsToHighlight.length ) {
            elementsToHighlight.forEach( function( lineElement ) {
              lineElement.classList.add( 'highlight-line' );
            } );

            block.classList.add( 'has-highlights' );
          }

        } );

      }

    },

    /**
     * Parses and formats a user-defined string of line
     * numbers to highlight.
     *
     * @example
     * RevealHighlight.deserializeHighlightSteps( '1,2|3,5-10' )
     * // [
     * //   [ { start: 1 }, { start: 2 } ],
     * //   [ { start: 3 }, { start: 5, end: 10 } ]
     * // ]
     */
    deserializeHighlightSteps: function( highlightSteps ) {

      // Remove whitespace
      highlightSteps = highlightSteps.replace( /\s/g, '' );

      // Divide up our line number groups
      highlightSteps = highlightSteps.split( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

      return highlightSteps.map( function( highlights ) {

        return highlights.split( RevealHighlight.HIGHLIGHT_LINE_DELIMITER ).map( function( highlight ) {

          // Parse valid line numbers
          if( /^[\d-]+$/.test( highlight ) ) {

            highlight = highlight.split( RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER );

            var lineStart = parseInt( highlight[0], 10 ),
              lineEnd = parseInt( highlight[1], 10 );

            if( isNaN( lineEnd ) ) {
              return {
                start: lineStart
              };
            }
            else {
              return {
                start: lineStart,
                end: lineEnd
              };
            }

          }
          // If no line numbers are provided, no code will be highlighted
          else {

            return {};

          }

        } );

      } );

    },

    /**
     * Serializes parsed line number data into a string so
     * that we can store it in the DOM.
     */
    serializeHighlightSteps: function( highlightSteps ) {

      return highlightSteps.map( function( highlights ) {

        return highlights.map( function( highlight ) {

          // Line range
          if( typeof highlight.end === 'number' ) {
            return highlight.start + RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER + highlight.end;
          }
          // Single line
          else if( typeof highlight.start === 'number' ) {
            return highlight.start;
          }
          // All lines
          else {
            return '';
          }

        } ).join( RevealHighlight.HIGHLIGHT_LINE_DELIMITER );

      } ).join( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

    }

  }

  Reveal.registerPlugin( 'highlight', RevealHighlight );

  return RevealHighlight;

}));
        
hljs.configure({
  ignoreUnescapedHTML: true,
});
hljs.highlightAll();
</script></body></html>